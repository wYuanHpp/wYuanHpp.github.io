<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  

  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-å¦‚ä½•è®¾è®¡ä¸€ä¸ªç®€å•çš„æ¨¡å—ç³»ç»Ÿ" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/04/27/å¦‚ä½•è®¾è®¡ä¸€ä¸ªç®€å•çš„æ¨¡å—ç³»ç»Ÿ/" class="article-date">
  <time datetime="2020-04-27T13:53:54.000Z" itemprop="datePublished">2020-04-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/04/27/å¦‚ä½•è®¾è®¡ä¸€ä¸ªç®€å•çš„æ¨¡å—ç³»ç»Ÿ/">å¦‚ä½•è®¾è®¡ä¸€ä¸ªç®€å•çš„æ¨¡å—ç³»ç»Ÿ</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>å‰ç«¯ç¤¾åŒºæ—©åœ¨å‡ å¹´å‰å°±è¿›åˆ°äº†æ¨¡å—åŒ–å¼€å‘æ–¹å¼ä¸­äº†, å®é™…ä¸Šes6ä¹‹å‰, jsæ˜¯æ²¡æœ‰æ¨¡å—æ¦‚å¿µçš„. æ—¢æ²¡æœ‰å˜é‡çš„å¯¼å‡º, ä¹Ÿæ²¡æœ‰å˜é‡çš„å¼•å…¥. </p>
<p>éšç€å‰ç«¯éœ€è¦æ‰¿æ‹…çš„åŠŸèƒ½è¶Šæ¥è¶Šç¹é‡, éœ€è¦å¤ç”¨çš„é€»è¾‘ä¹Ÿè¶Šæ¥è¶Šå¤š, å…¨å±€å˜é‡è¶Šæ¥è¶Šå®¹æ˜“ç¢°æ’, å‰ç«¯æ€¥éœ€ä¸€ä¸ªæ¨¡å—åŒ–æ–¹æ¡ˆ. é‚£ä¹ˆæ—¢ç„¶<code>javascript</code>è¯­è¨€æœ¬èº«å¹¶æ²¡æœ‰æ¨¡å—åŒ–åŠŸèƒ½, ä½†æ˜¯å¤§ä½¬ä»¬å¿…ç„¶æ˜¯æœ‰åŠæ³•çš„. äºæ˜¯å„ç§æ¨¡å—åŒ–æ–¹æ¡ˆåˆ†åˆ†å‡ºç°<code>CMD</code> <code>AMD</code> <code>CommonJS</code>, å†es6è§„èŒƒå‡ºæ¥å‰, è¿™ä¸‰ç§æ–¹æ¡ˆå‡ ä¹ç»Ÿæ²»äº†æ‰€æœ‰<code>javascript</code>å¼€å‘. ä»–ä»¬éƒ½åœ¨è‡ªå·±ä¸åŒçš„é¢†åŸŸä»–æå‡ºäº†å®ç°æ–¹æ¡ˆ, å¹¶è§£å†³äº†è¯¸å¤šçš„é—®é¢˜.</p>
<p>æ²¡æƒ³åˆ°çš„æ˜¯, å‰ç«¯æ˜¯åœ¨å˜åŒ–å¤ªå¿«, 2015å¹´es6å‘å¸ƒ, ä»æ­¤<code>javascript</code>æœ‰äº†è‡ªå·±çš„æ¨¡å—åŒ–æ–¹æ¡ˆ. å¹¶ä¸”å¾ˆå¿«, åŸºäºæ¨¡å—åŒ–çš„æ‰“åŒ…å·¥å…·<code>webpack</code>å‘å¸ƒ, æŠŠå‰ç«¯å·¥ç¨‹åŒ–æ‹‰ä¸Šä¸€ä¸ªå…¨æ–°é«˜åº¦â€”-ä¸‡ç‰©çš†æ¨¡å—.<br>å–„äºæ¥å—å˜åŒ–çš„å‰ç«¯ç¤¾åŒºç»Ÿç»Ÿæ‹¥æŠ±<code>webpack</code>, å¾ˆå¿«<code>webpack</code>å¤©ä¸‹å¤§ç»Ÿ, ä¹‹å‰çš„ä¸‰å¤§è§£å†³æ–¹æ¡ˆ,é™¤äº†<code>commonJS</code>å› ä¸º<code>NodeJS</code>äº²å„¿å­çš„é«˜è´µè¡€ç»Ÿ, <code>CMD</code> <code>AMD</code>çš„ä¸¤ä¸ªæ–¹æ¡ˆ<code>require.js</code> <code>sea.js</code>å‡ ä¹å·²ç»å‘Šåˆ«æ±Ÿæ¹–, æˆä¸ºå†å², å˜æˆäº†è€å‰ç«¯å›å¿†è‡ªå·±å³¥åµ˜å²æœˆçš„è°ˆèµ„äº†. æ˜¯ä¸æ˜¯å¾ˆåƒ<code>jquery</code>çš„ç»å†?</p>
<p>æ—¢ç„¶<code>webpack</code>è¿™ä¹ˆå‰å®³, é‚£ä¹ˆä»–çš„æ‰“åŒ…æ–¹æ¡ˆæ˜¯ä»€ä¹ˆ? æ˜¯<code>esModule</code>ä¹ˆ?</p>
<h3 id="webpackæ—¶ä»£"><a href="#webpackæ—¶ä»£" class="headerlink" title="webpackæ—¶ä»£"></a>webpackæ—¶ä»£</h3><p>å®é™…ä¸Šç”±äºwebpackæ˜¯åŸºäº<code>NodeJs</code>çš„è¿è¡Œæ—¶, æ‰€ä»¥webpackæ˜¾ç„¶ä¸€å¼€å§‹æ˜¯ä½¿ç”¨çš„<code>commonJS</code>çš„æ–¹æ¡ˆ, ç›¸æ¯”<code>CMD</code> <code>AMD</code>,<code>commonJS</code>çš„ç¾¤ä½“æ¯”è¾ƒå¤§, å› ä¸ºæ˜¯è¿è¡Œå†<code>NodeJS</code>ä¸Š, <code>webpack</code>çš„é…ç½®æ–‡ä»¶,plugin,loader,éƒ½å¿…é¡»ä½¿ç”¨<code>commonJS</code>çš„æ–¹å¼æ¥å¼•å…¥, æ‰€ä»¥å…¶ä»–ä»£ç å¦‚æœéƒ½æ˜¯ç”¨ä¸€å¥—æ–¹æ¡ˆ,è¿™æ ·ä¹Ÿæ¯”è¾ƒç»Ÿä¸€, ä¹Ÿç¬¦åˆç›´è§‰. </p>
<p>è™½ç„¶webpackå†jsä»£ç çš„æ¨¡å—åŠ è½½æ˜¯æŒ‰ç…§<code>commonJS</code>è§„èŒƒæ¥çš„, ä½†æ˜¯å®é™…ä¸Šç”±äºæ‰“åŒ…åçš„ä»£ç æ˜¯è¿è¡Œå†å‰ç«¯çš„, æ‰€ä»¥éœ€è¦å®ç°ä¸€ä¸ªå‰ç«¯çš„æ¨¡å—åŠ è½½è¿è¡Œæ—¶, é‚£ä¹ˆwebpackåˆ°åº•æ˜¯æ€ä¹ˆè®©åŸºäº<code>nodeJS</code>çš„æ¨¡å—ç³»ç»Ÿå†æ‰“åŒ…åèƒ½æˆåŠŸè¿è¡Œå†å‰ç«¯å‘¢?</p>
<h3 id="å¦‚ä½•å®ç°ä¸€ä¸ªæ¨¡å—"><a href="#å¦‚ä½•å®ç°ä¸€ä¸ªæ¨¡å—" class="headerlink" title="å¦‚ä½•å®ç°ä¸€ä¸ªæ¨¡å—"></a>å¦‚ä½•å®ç°ä¸€ä¸ªæ¨¡å—</h3><p>ç†æƒ³çš„ä¸€ä¸ªjs moduleåº”è¯¥æ˜¯æœ‰è‡ªå·±çš„ç¯å¢ƒ, æ¨¡å—ä¹‹é—´äº’ç›¸æ— æ³•å½±å“, ç›¸äº’è§çš„å…¨å±€å˜é‡éƒ½æ˜¯ä¸å¯è§çš„. å¹¶ä¸”æ¨¡å—éœ€è¦å¯ä»¥å¯¼å‡ºæ•°æ®, è¿˜è¦èƒ½å¤ŸåŠ è½½å…¶ä»–æ¨¡å—å¯¼å‡ºçš„æ•°æ®.é‚£ä¹ˆè¿™æ ·çš„åŠŸèƒ½æˆ‘ä»¬è¯¥å¦‚ä½•å®ç°å‘¢?</p>
<h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><p>æˆ‘ä»¬å…ˆå®šä¹‰ä¸¤ä¸ªä¸‰ä¸ªæ–‡ä»¶, äº’ç›¸åŠ è½½ä¸€ä¸‹:</p>
<p><em>/index.js</em><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> moduleA = <span class="built_in">require</span>(<span class="string">'./dep.js'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'hello world'</span>)</span><br></pre></td></tr></table></figure></p>
<p><em>/dep.js</em><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> moduleA = <span class="built_in">require</span>(<span class="string">'./common.js'</span>)</span><br><span class="line"><span class="keyword">var</span> funA = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line"><span class="built_in">module</span>.exports = funA;</span><br></pre></td></tr></table></figure></p>
<p><em>/common.js</em><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> util = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line"><span class="built_in">module</span>.exports = util;</span><br></pre></td></tr></table></figure></p>
<p>ä»–ä»¬çš„ä¾èµ–å…³ç³»å¦‚ä¸‹: <code>index.js</code> -&gt; <code>dep.js</code> -&gt; <code>common.js</code>;</p>
<p>å¥½äº†, æ—¢ç„¶ä¸Šé¢çš„ç¤ºä¾‹å·²ç»å®šå¥½äº†, ä½¿ç”¨çš„æ˜¯<code>commonJS</code>çš„è§„èŒƒ, æ—¢ç„¶æˆ‘ä»¬è¦å®ç°ä¸€ä¸ªç®€å•ç‰ˆçš„æ¨¡å—ç³»ç»Ÿ, é‚£ä¹ˆå…ˆæ¥åˆ†æåˆ†æè¿™é‡Œä¼šç”¨åˆ°çš„è¯­æ³•æŠŠ</p>
<h3 id="åŸºæœ¬è¯­æ³•"><a href="#åŸºæœ¬è¯­æ³•" class="headerlink" title="åŸºæœ¬è¯­æ³•"></a>åŸºæœ¬è¯­æ³•</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// import ä»£ç </span></span><br><span class="line"><span class="keyword">var</span> moduleA = <span class="built_in">require</span>(<span class="string">'./a.js'</span>)</span><br><span class="line"><span class="keyword">var</span> funA = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line"><span class="comment">// export å¯¼å‡ºä»£å‘æ–¹å¼1</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  funA</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// or å¯¼å‡ºä»£ç æ–¹å¼2</span></span><br><span class="line">exports.funcA = funA;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸Šé¢çš„ä¸¤ç§å¯¼å‡ºæ–¹å¼æ˜¯ç­‰ä»·çš„</span></span><br></pre></td></tr></table></figure>
<p>ä»ä¸Šé¢çš„ä»£ç ,æˆ‘ä»¬å¯ä»¥çœ‹åˆ°, è¿™é‡Œæœ‰ä¸‰ä¸ªå…¨å±€å˜é‡<code>require</code> <code>module</code> <code>exports</code>, è¿™ä¸‰ä¸ªå…¨å±€å˜é‡æˆ‘ä»¬å¾…ä¼šå†è¯´</p>
<h3 id="å¼€å§‹"><a href="#å¼€å§‹" class="headerlink" title="å¼€å§‹"></a>å¼€å§‹</h3><p>ok, æ—¢ç„¶æ˜¯æ¨¡å—, é¦–å…ˆéœ€è¦è€ƒè™‘çš„å°±æ˜¯éš”ç¦»å…¨å±€å˜é‡, æ¢è€Œè¨€ä¹‹å°±æ˜¯è¦è®©æ¯ä¸€ä¸ªæ¨¡å—çš„æ‰§è¡Œç¯å¢ƒéƒ½åœ¨ä¸åŒçš„ä½œç”¨äºä¸‹,<br>é‚£ä¹ˆå¦‚ä½•å½¢æˆæ–°çš„ä½œç”¨äºæˆ‘å°±ä¸å¤šè¯´äº†,åªè¦ä½¿ç”¨ä¸€ä¸ªå‡½æ•°æŠŠæ¨¡å—ä¸­çš„ä»£ç è¿›è¡ŒåŒ…è£¹å°±å¯ä»¥äº†,å°±åƒè¿™æ ·:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params">require, module, exports</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> moduleA = <span class="built_in">require</span>(<span class="string">'./a.js'</span>)</span><br><span class="line">  <span class="keyword">var</span> funA = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line">  <span class="comment">// export</span></span><br><span class="line">  <span class="built_in">module</span>.exports = funA;</span><br><span class="line">  <span class="comment">// or</span></span><br><span class="line">  exports.funA = funA</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·æ¨¡å—å…§çš„å…¨å±€å˜é‡å°±éƒ½å˜æˆäº†è¿™ä¸ªå‡½æ•°çš„å±€éƒ¨å˜é‡, ç°åœ¨åªéœ€æŠŠå…¨å±€å˜é‡é€šè¿‡æ¨¡å—çš„å‡½æ•°å‚æ•°ä¼ å…¥, é‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦è§£å†³ä¸¤ä¸ªé—®é¢˜:</p>
<ul>
<li>å¦‚ä½•æŠŠæ‰€æœ‰çš„æ¨¡å—éƒ½æ”¹å†™æˆåŒ…è£¹å‡½æ•°çš„æ–¹å¼, å¹¶ä¸”æŠŠè¿™äº›å‡½æ•°æ‰¾ä¸ªåœ°æ–¹ç»Ÿä¸€ç®¡ç†èµ·æ¥</li>
<li>å¦‚ä½•å®ç°<code>require</code> å’Œ <code>module</code> <code>exports</code> è¿™ä¸‰ä¸ªå˜é‡</li>
</ul>
<h3 id="è§£æä¾èµ–æ ‘"><a href="#è§£æä¾èµ–æ ‘" class="headerlink" title="è§£æä¾èµ–æ ‘"></a>è§£æä¾èµ–æ ‘</h3><p>ç¬¬ä¸€ä¸ªé—®é¢˜, å¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰çš„æ–‡ç« , ä½¿ç”¨<code>babel</code>æ¥è§£æå…¥å£æ–‡ä»¶<code>index.js</code></p>
<p>å› ä¸ºåœ¨è§£æè¿‡ç¨‹ä¸­, æˆ‘ä»¬éœ€è¦è·å–æ‰€æœ‰çš„æ¨¡å—, å¹¶ä¸”ç”Ÿæˆè¿™ä¸ªæ¨¡å—çš„å”¯ä¸€id, æ–¹ä¾¿èµ·è§, æˆ‘ä»¬ç›´æ¥å·²æ¨¡å—çš„é¡¹ç›®ç›¸å¯¹è·¯å¾„ä¸ºkeyæ¥è®°å½•</p>
<p>æ•´ä¸ªè¿‡ç¨‹å¤§æ¦‚åˆ†ä¸‹é¢å‡ éƒ¨:</p>
<ol>
<li>ä»å…¥å£æœªè§è§£æ, åªè¦é‡åˆ°requireæ–¹æ³•çš„è°ƒç”¨, å°±è§£æä»–çš„å‚æ•°æ¥è¯»å–å¯¹åº”çš„æ¨¡å—æ–‡ä»¶, å¹¶ä¿®æ”¹requireçš„å‚æ•°ä¸ºrequireæ–‡ä»¶çš„é¡¹ç›®ç›¸å¯¹è·¯å¾„</li>
<li>è®°å½•ä¸‹æ–‡ä»¶çš„è·¯å¾„, å¹¶jsæ–‡ä»¶å­—ç¬¦ä¸²,å¯¹å…¶è¿›è¡ŒåŒ…è£¹</li>
<li>é€’å½’çš„é‡å¤ä¸Šé¢ä¸¤æ­¥è§£æjsç›´åˆ°è·å–æ‰€æœ‰çš„ä¾èµ–æ–‡ä»¶.</li>
<li>éå†åç”Ÿæˆä¸€ä¸ªè·¯å¾„åˆ°æ¨¡å—çš„mappingå³å¯, ç”Ÿæˆåçš„æ¨¡å—å›¾å¤§æ¦‚å¦‚æ­¤<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> loadedModulesMap = &#123;</span><br><span class="line">  <span class="string">'src/dep.js'</span>: <span class="function"><span class="keyword">function</span>(<span class="params">require, module, exports</span>) </span>&#123; </span><br><span class="line">    <span class="keyword">var</span> moduleA = <span class="built_in">require</span>(<span class="string">'src/common.js'</span>)</span><br><span class="line">    <span class="comment">/* code */</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">'src/common.js'</span>: <span class="function"><span class="keyword">function</span>(<span class="params">require, module, exports</span>) </span>&#123; <span class="comment">/* code */</span> &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="å®ç°require"><a href="#å®ç°require" class="headerlink" title="å®ç°require"></a>å®ç°require</h3><p>è§£å†³ç¬¬äºŒä¸ªé—®é¢˜, ç å­—å¤ªéº»çƒ¦, ç›´æ¥ä¸Šä»£ç æŠŠ</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿™é‡Œè®°å½•çš„æ˜¯ç¬¬ä¸€æ­¥è§£æå‡ºæ¥çš„æ‰€æœ‰ä¾èµ–æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">const</span> loadedModulesMap = &#123;</span><br><span class="line">  <span class="string">'src/dep.js'</span>: <span class="function"><span class="keyword">function</span>(<span class="params">require, module, exports</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> moduleA = <span class="built_in">require</span>(<span class="string">'src/common.js'</span>)</span><br><span class="line">    <span class="keyword">var</span> funA = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line">    <span class="built_in">module</span>.exports = funA;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">'src/common.js'</span>: <span class="function"><span class="keyword">function</span>(<span class="params">require, module, exports</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> util = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line">    <span class="built_in">module</span>.exports = util; </span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// ç¼“å­˜, é˜²æ­¢é‡å¤åŠ è½½ç›¸åŒçš„æ¨¡å—</span></span><br><span class="line"><span class="keyword">const</span> cacheModulesMap = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰requireæ–¹æ³•</span></span><br><span class="line"><span class="built_in">require</span>(path) &#123;</span><br><span class="line">  <span class="comment">// å…ˆèµ°ç¼“å­˜</span></span><br><span class="line">  <span class="keyword">if</span> (cacheModulesMap[path]) &#123;</span><br><span class="line">    <span class="keyword">return</span> cacheModulesMap[path].exports;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// æ³¨å†Œç¼“å­˜, æ‹¿åˆ°ç¼“å­˜ä¸Šçš„å¼•ç”¨æŒ‡é’ˆ</span></span><br><span class="line">  <span class="keyword">const</span> <span class="built_in">module</span> = cacheModulesMap[path] = &#123; <span class="attr">exports</span>: &#123;&#125; &#125;;</span><br><span class="line">  <span class="comment">// å»æ¨¡å—mapé‡Œæ‹¿å¯¹åº”çš„æ¨¡å—</span></span><br><span class="line">  <span class="keyword">const</span> modulesFn = loadedModulesMap.path;</span><br><span class="line">  <span class="comment">// æ‰§è¡Œæ¨¡å—, è¿™é‡Œè¦æ³¨æ„, æ¨¡å—çš„å¯¼å‡ºå€¼ç°å†™å…¥çš„moduleä¸Š, ç”±äºmoduleæ˜¯</span></span><br><span class="line">  <span class="comment">// cacheModulesMapçš„å¼•ç”¨, æ‰€ä»¥å¯¼å‡ºå€¼éƒ½ä¼šåŒæ—¶è¢«ä¿å­˜</span></span><br><span class="line">  modulesFn(<span class="built_in">require</span>, <span class="built_in">module</span>, <span class="built_in">module</span>.exports );</span><br><span class="line">  <span class="comment">// moduleå·²ç»æ‹¿åˆ°å¯¼å‡ºå€¼äº†, ç›´æ¥è¿”å›å¯¹åº”å¯¼å‡ºå€¼</span></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">module</span>.export;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿è¡Œå…¥å£æ–‡ä»¶ä»£ç , ä¸€åˆ‡æ…¢æ…¢å±•å¼€</span></span><br><span class="line"><span class="keyword">var</span> moduleA = <span class="built_in">require</span>(<span class="string">'src/dep.js'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'hello world'</span>)</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·, ä¸€ä¸ªè§£æåçš„ä»£ç , å°±å¯ä»¥è¢«æ­£å¸¸çš„è¿è¡Œäº†, è¿™é‡Œæˆ‘ä»¬å¯ä»¥å‘ç°ä¸€ä¸ª<code>commonJS</code>æ¨¡å—çš„ä¸€ä¸ªç‰¹ç‚¹, å°±æ˜¯æ¨¡å—çš„åŠ è½½æ˜¯åœ¨è¿è¡Œæ—¶å®Œæˆçš„, ä¹Ÿå°±æ˜¯è¯´, åªæœ‰åœ¨ä»£ç è¿è¡Œçš„æ—¶å€™, æ¨¡å—æ‰ä¼šè¢«åŠ è½½, å¹¶ä¸”åŠ è½½é¡ºåºå’Œä»£ç çš„è°ƒç”¨é¡ºåºæ˜¯å¼ºå…³è”çš„, è¿™ä¸ªå’ŒesModuleæ˜¯ä¸åŒçš„, æ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥å»äº†è§£ä¸€ä¸‹ä¸¤è€…ä¹‹é—´çš„åŒºåˆ«</p>
<h3 id="å¼‚æ­¥require"><a href="#å¼‚æ­¥require" class="headerlink" title="å¼‚æ­¥require"></a>å¼‚æ­¥require</h3><h4 id="å¼‚æ­¥æ¨¡å—æ•°æ®ç»“æ„"><a href="#å¼‚æ­¥æ¨¡å—æ•°æ®ç»“æ„" class="headerlink" title="å¼‚æ­¥æ¨¡å—æ•°æ®ç»“æ„"></a>å¼‚æ­¥æ¨¡å—æ•°æ®ç»“æ„</h4><p>ä¸Šé¢æ˜¯æˆ‘ä»¬æ™®é€šçš„requireæ¨¡å—çš„ç®€å•å®ç°. ä½†æ˜¯åœ¨è„±ç¦»çš„<code>node</code>ç¯å¢ƒå, å‰ç«¯èµ„æºå®é™…ä¸Šå¾ˆå¤§ç¨‹åº¦ä¸Šæ˜¯ä¾èµ–äºå¼‚æ­¥è·å–çš„,é‚£ä¹ˆä¸€ä¸ªéœ€è¦å¼‚æ­¥è·å–çš„æ¨¡å—åº”è¯¥è®¾è®¡æˆä»€ä¹ˆæ ·å‘¢? çœ‹çœ‹ä¸‹é¢çš„æ•°æ®ç»“æ„;</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">`src/async.js`</span>: <span class="function"><span class="keyword">function</span>(<span class="params">require, module, exports</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> asyncFn = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line">    <span class="built_in">module</span>.exports = funA;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªç»“æ„ä¿ç•™äº†æˆ‘ä»¬ä¸Šé¢<code>loadedModulesMap</code>çš„æ•°æ®ç»“æ„, æ–¹ä¾¿mergeåˆ°é‡Œé¢å», ç°åœ¨éœ€è¦è®¾è®¡ä¸€ç§åŠ è½½æœºåˆ¶, æŠŠè¿™éƒ¨åˆ†ä»£ç åŠ è½½åˆ°<code>loadedModulesMap</code>é‡Œ</p>
<h4 id="ä¸»ä»£ç å¦‚ä½•åŠ è½½å¼‚æ­¥ä»£ç "><a href="#ä¸»ä»£ç å¦‚ä½•åŠ è½½å¼‚æ­¥ä»£ç " class="headerlink" title="ä¸»ä»£ç å¦‚ä½•åŠ è½½å¼‚æ­¥ä»£ç "></a>ä¸»ä»£ç å¦‚ä½•åŠ è½½å¼‚æ­¥ä»£ç </h4><p><code>webpack</code>å®ç°äº†ä¸€ç§å¼‚æ­¥åŠ è½½çš„æ–¹æ³•<code>require.ensure</code>, æˆ‘ä»¬å°±æ²¿ç”¨æŠŠ, åªä¸è¿‡æ—¢ç„¶æ˜¯ç®€å•ç‰ˆ, å°±ä¸€ä¸ªå‚æ•°å§! æˆ‘ä»¬è®©<code>dep.js</code>å˜æˆå¼‚æ­¥åŠ è½½common.js</p>
<p><em>/dep.js</em><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¹‹å‰</span></span><br><span class="line"><span class="keyword">var</span> moduleA = <span class="built_in">require</span>(<span class="string">'./common.js'</span>)</span><br><span class="line"><span class="keyword">var</span> funA = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line"><span class="built_in">module</span>.exports = funA;</span><br><span class="line"><span class="comment">// ä¹‹å</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> moduleA = <span class="built_in">require</span>.ensure(<span class="string">'./common.js'</span>).then(<span class="function">(<span class="params">util</span>) =&gt;</span> &#123;</span><br><span class="line">  util.xxx();</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">var</span> funA = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line"><span class="built_in">module</span>.exports = funA;</span><br></pre></td></tr></table></figure></p>
<h4 id="å¼‚æ­¥æ¨¡å—è®¾è®¡"><a href="#å¼‚æ­¥æ¨¡å—è®¾è®¡" class="headerlink" title="å¼‚æ­¥æ¨¡å—è®¾è®¡"></a>å¼‚æ­¥æ¨¡å—è®¾è®¡</h4><p>æœ‰ä¸€ç‚¹å¯ä»¥è‚¯å®š, æˆ‘ä»¬è‚¯å®šä¸èƒ½ä½¿ç”¨Ajaxçš„æ–¹å¼è¿›è¡Œ, å› ä¸ºæˆ‘ä»¬éœ€è¦æ‰§è¡Œå®ƒ, æ‰€ä»¥æˆ‘ä»¬é€‰æ‹©ä½¿ç”¨scriptæ ‡ç­¾, é‚£ä¹ˆåªæœ‰ä¸€æ¡è·¯äº†! JSONP!</p>
<p><em>å¼‚æ­¥æ¨¡å—</em><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸¤è¾¹å®šä¹‰ä¸€ä¸ªå…±æœ‰å˜é‡ JSON_LIST</span></span><br><span class="line"><span class="comment">// å¼‚æ­¥æ¨¡å—åœ¨åŠ è½½åç›´æ¥æ‰§è¡Œ, æŠŠæ¨¡å—æŒ‚è½½çš„å…¨å±€é˜Ÿåˆ—é‡Œ, ç­‰å¾…ä¸»æ¨¡å—è¯»å–</span></span><br><span class="line"><span class="built_in">window</span>.JSONP_LIST.push(</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">`src/async.js`</span>: <span class="function"><span class="keyword">function</span>(<span class="params">require, module, exports</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> asyncFn = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line">    <span class="built_in">module</span>.exports = funA;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p><em>ä¸»æ¨¡å—</em><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰å¼‚æ­¥åŠ è½½æ¨¡å—çš„æ–¹æ³•</span></span><br><span class="line"><span class="built_in">require</span>.ensure = <span class="function"><span class="keyword">function</span>(<span class="params">path</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// è¯´æ˜å¼‚æ­¥æ¨¡å—æ²¡åŠ è½½</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­æ˜¯å¦åŠ è½½è¿‡äº†</span></span><br><span class="line">    <span class="keyword">if</span> (!loadedModulesMap[path]) &#123;</span><br><span class="line">      resolve(<span class="built_in">require</span>(path));</span><br><span class="line">    &#125;  </span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰scriptæ ‡ç­¾</span></span><br><span class="line">    <span class="keyword">var</span> script = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>);</span><br><span class="line">    <span class="comment">// å…¨å±€å…¬å…±è·¯å¾„ + ç›¸å¯¹è·¯å¾„æ‹¼æ¥è¯·æ±‚, ç®€å•å¤„ç†å•¦!</span></span><br><span class="line">    <span class="keyword">var</span> url = PUBLIC_PATH + path;</span><br><span class="line">    script.url = url;</span><br><span class="line">    <span class="comment">// å®šä¹‰åŠ è½½å®Œæˆåçš„æˆåŠŸå›è°ƒ</span></span><br><span class="line">    script.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// æ¨¡å—è¯·æ±‚æˆåŠŸå, åŠ è½½é˜Ÿåˆ—é‡Œçš„æ‰€æœ‰æ¨¡å—</span></span><br><span class="line">      <span class="built_in">window</span>.JSONP_LIST.forEach(<span class="function">(<span class="params">moduleObj</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">Object</span>.keys(moduleObj).forEach(<span class="function">(<span class="params">_path</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (!loadedModulesMap[_path]) &#123;</span><br><span class="line">            loadedModulesMap[_path] = moduleObj[_path];</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;) </span><br><span class="line">      <span class="comment">// å¤„ç†äº†JSON_LISTé‡Œé¢å·²ç»åŠ è½½éƒ­çš„æ¨¡å—å°±è¦æ¸…ç©º</span></span><br><span class="line">      <span class="built_in">window</span>.JSON_LIST = [];</span><br><span class="line">      <span class="comment">// è¿™æ—¶ å·²ç»æˆåŠŸåŠ è½½äº†å¼‚æ­¥æ¨¡å—, è¿™æ—¶å€™è¿”å›æ¨¡å—å€¼</span></span><br><span class="line">      <span class="keyword">if</span> (!loadedModulesMap[path]) &#123;</span><br><span class="line">        resolve(<span class="built_in">require</span>(path));</span><br><span class="line">      &#125;  </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">document</span>.head.appendChild(script);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="ä¸€äº›å…¶ä»–ç»†èŠ‚"><a href="#ä¸€äº›å…¶ä»–ç»†èŠ‚" class="headerlink" title="ä¸€äº›å…¶ä»–ç»†èŠ‚"></a>ä¸€äº›å…¶ä»–ç»†èŠ‚</h4><p>åœ¨å¢åŠ äº†<code>require.ensure</code>ä¹‹å, ä½ éœ€è¦åœ¨è§£ææ–‡ä»¶çš„æ—¶å€™è€ƒè™‘å¼‚æ­¥åŠ è½½çš„æƒ…å†µ:</p>
<ul>
<li>è§£æ<code>require.ensure</code>çš„è°ƒç”¨</li>
<li>å¼‚æ­¥åº”ä¾èµ–çš„å­æ ‘å•ç‹¬ç”Ÿæˆå¼‚æ­¥æ¨¡å—æ–‡ä»¶</li>
</ul>
<p>æœ€åç”Ÿæˆçš„ä»£ç åº”è¯¥æ˜¯:</p>
<p>ä¸»æ–‡ä»¶<em>main.js</em>:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> loadedModulesMap = &#123;</span><br><span class="line">  <span class="string">'src/dep.js'</span>: <span class="function"><span class="keyword">function</span>(<span class="params">require, module, exports</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> moduleA = <span class="built_in">require</span>.ensure(<span class="string">'src/common.js'</span>)</span><br><span class="line">    <span class="keyword">var</span> funA = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line">    <span class="built_in">module</span>.exports = funA;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> cacheModulesMap = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">require</span>(path) &#123;</span><br><span class="line">  <span class="keyword">if</span> (cacheModulesMap[path]) &#123;</span><br><span class="line">    <span class="keyword">return</span> cacheModulesMap[path].exports;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> <span class="built_in">module</span> = cacheModulesMap[path] = &#123; <span class="attr">exports</span>: &#123;&#125; &#125;;</span><br><span class="line">  <span class="keyword">const</span> modulesFn = loadedModulesMap.path;</span><br><span class="line">  modulesFn(<span class="built_in">require</span>, <span class="built_in">module</span>, <span class="built_in">module</span>.exports );</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">module</span>.export;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">require</span>.ensure = <span class="function"><span class="keyword">function</span>(<span class="params">path</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!loadedModulesMap[path]) &#123;</span><br><span class="line">      resolve(<span class="built_in">require</span>(path));</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">var</span> script = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>);</span><br><span class="line">    <span class="keyword">var</span> url = PUBLIC_PATH + path;</span><br><span class="line">    script.url = url;</span><br><span class="line">    script.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">window</span>.JSONP_LIST.forEach(<span class="function">(<span class="params">moduleObj</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">Object</span>.keys(moduleObj).forEach(<span class="function">(<span class="params">_path</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (!loadedModulesMap[_path]) &#123;</span><br><span class="line">            loadedModulesMap[_path] = moduleObj[_path];</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;) </span><br><span class="line">      <span class="built_in">window</span>.JSON_LIST = [];</span><br><span class="line">      <span class="keyword">if</span> (!loadedModulesMap[path]) &#123;</span><br><span class="line">        resolve(<span class="built_in">require</span>(path));</span><br><span class="line">      &#125;  </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">document</span>.head.appendChild(script);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> moduleA = <span class="built_in">require</span>(<span class="string">'src/dep.js'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'hello world'</span>)</span><br></pre></td></tr></table></figure></p>
<p>å¼‚æ­¥æ–‡ä»¶<em>src/common.js</em>;<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.JSONP_LIST.push(</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">`src/common.js`</span>: <span class="function"><span class="keyword">function</span>(<span class="params">require, module, exports</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> util = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line">    <span class="built_in">module</span>.exports = util;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<h3 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h3><p>ä»¥ä¸Šåªæ˜¯ä¸€ä¸ªéå¸¸éå¸¸ç®€å•çš„æ¨¡å—åŠ è½½ç³»ç»Ÿ, ç©å…·ä¸­çš„ç©å…·, ä½†æ˜¯è¿™ä¸å¦¨ç¢æˆ‘ä»¬ç†è§£<code>js</code>æ¨¡å—åŒ–çš„æœ¬è´¨, åªè¦çœ‹æ˜ç™½æœ¬è´¨, å®é™…ä¸Š<code>webpack</code>é‚£äº›<br>çœ¼èŠ±ç¼­ä¹±çš„æ“ä½œä¹Ÿå°±ä¸å†é‚£ä¹ˆç¥å¥‡äº†</p>
<p>å¦‚æœä¹‹åæœ‰æœºä¼š, æˆ‘ä¹Ÿè®¸ä¼šåœ¨è¿™ä¸ªç¯‡æ–‡ç« é‡Œè¡¥å…¨ç®€æ˜“ç‰ˆçš„webpack module federation, æ•¬è¯·æœŸå¾…â€¦â€¦</p>
<p>ä¹Ÿè®¸æ˜¯åä¼šæ— æœŸ?(å¤§ç¬‘ğŸ˜„,é€ƒâ€¦â€¦)</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/04/27/å¦‚ä½•è®¾è®¡ä¸€ä¸ªç®€å•çš„æ¨¡å—ç³»ç»Ÿ/" data-id="ck9ik1ty2000bwhroxhlsr1d2" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-å¦‚ä½•è®¾è®¡ä¸€ä¸ªæ’ä»¶ç³»ç»Ÿ" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/03/29/å¦‚ä½•è®¾è®¡ä¸€ä¸ªæ’ä»¶ç³»ç»Ÿ/" class="article-date">
  <time datetime="2020-03-29T12:02:23.000Z" itemprop="datePublished">2020-03-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/03/29/å¦‚ä½•è®¾è®¡ä¸€ä¸ªæ’ä»¶ç³»ç»Ÿ/">å¦‚ä½•è®¾è®¡ä¸€ä¸ªæ’ä»¶ç³»ç»Ÿ</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å‰ç«¯çš„æ—¥å¸¸å¼€å‘, ç¦»ä¸å¼€ä¼—å¤šç”±ç¤¾åŒºæä¾›çš„ç¬¬ä¸‰æ–¹library, ä»åˆ›å»ºåˆ°é¡¹ç›®æ‰“åŒ…å†åˆ°ä»£ç çš„è¿è¡Œæ—¶ç»Ÿç»Ÿéƒ½å°‘ä¸äº†å®ƒä»¬çš„èº«å½±. æˆ‘ä»¬å†ä½¿ç”¨ä»–ä»¬çš„æ—¶å€™ç”±äºä¸åŒçš„ä¸šåŠ¡éœ€æ±‚,æœ‰æ—¶å€™éœ€è¦å¯¹ä»–ä»¬è¿›è¡Œä¸€äº›ä¿®æ”¹. è€Œè®¾è®¡ä¼˜ç§€çš„çš„libraryé€šå¸¸éƒ½æœ‰ä¸€äº›æ–¹å¼å¯¹ä½¿ç”¨è€…æä¾›æ‰©å±•çš„èƒ½åŠ›, è¿™ç§æä¾›æ‰©å±•èƒ½åŠ›çš„æ–¹æ³•é€šå¸¸å«åšæ’ä»¶</p>
<p>è¯´åˆ°æ’ä»¶å¤§å®¶åº”è¯¥éƒ½ä¸é™Œç”Ÿ, å‡ ä¹å†æ—¥å¸¸å¼€å‘ä¸­èƒ½ç”¨åˆ°å½¢å½¢è‰²è‰²çš„æ’ä»¶, æ¯”å¦‚webpackçš„plugin, babelçš„plugin, æˆ–è€…æ˜¯eslintçš„plugin, åˆæˆ–è€…æ˜¯vueçš„plugin,ç”šè‡³æ˜¯å¾ˆå¤šcoderéƒ½åœ¨ä½¿ç”¨çš„vscodeçš„extendç­‰ç­‰, æ•°ä¸èƒœæ•°. é‚£ä¹ˆè¿™äº›ä¼˜ç§€çš„é¡¹ç›®çš„æ‰©å±•ä½“ç³»éƒ½æ˜¯å¦‚ä½•è®¾è®¡çš„? ä»–ä»¬åˆä¸ºä»€ä¹ˆè¿™ä¹ˆè®¾è®¡? æˆ‘ä»¬èƒ½ä»è¿™å½“ä¸­å­¦ä¹ åˆ°ä»€ä¹ˆ? æ¥ä¸‹æ¥æˆ‘å°†ä»ä¸€ä¸ªç®€å•çš„å°åŠŸèƒ½ä½œä¸ºä¾‹å­,ä»¥ä¸€ä¸ªlibraryå¼€å‘è€…çš„è§’åº¦æ¥è€ƒè™‘, ä¸€ä¸ªæ’ä»¶ç³»ç»Ÿåº”è¯¥å¦‚ä½•è®¾è®¡.</p>
<h2 id="èµ·æ­¥"><a href="#èµ·æ­¥" class="headerlink" title="èµ·æ­¥"></a>èµ·æ­¥</h2><p>ä¸€ä¸‹æ˜¯ä¸€ä¸ªéå¸¸ç®€å•åŠŸèƒ½ä¾‹å­, å°±å«ä»–miniLibraryå§! å®ƒçš„æ‰§è¡Œé¡ºåºååˆ†ç®€å•: è¾“å…¥æ•°æ® -&gt; æ•°æ®å¤„ç† -&gt; æ¸²æŸ“æ•°æ®:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DataProcessRender</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;&#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  process(a, b) &#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  apply(a, b, targetDom) &#123;</span><br><span class="line">    <span class="keyword">this</span>.state &#123;</span><br><span class="line">      a,</span><br><span class="line">      b,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">this</span>.targetDom = targetDom;</span><br><span class="line">    <span class="keyword">this</span>.render();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="built_in">document</span>.querySelector(<span class="keyword">this</span>.state.targetDom).innerHtml = process(<span class="keyword">this</span>.state.a, <span class="keyword">this</span>.state.b);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è°ƒç”¨çš„æ–¹æ³•:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> render = <span class="keyword">new</span> DateProcessRender()</span><br><span class="line">render.apply(<span class="string">'hello'</span>, <span class="string">' world!!'</span>, <span class="string">'#app'</span>);</span><br></pre></td></tr></table></figure></p>
<p>æ˜¾ç„¶ç›®å‰çœ‹æ¥, è¿™ä¸ªlibraryä¸ä»…å¾ˆç®€å•, è€Œä¸”æ ¹æœ¬æ²¡æœ‰ä»»ä½•æ‰©å±•å¯è¨€, é™¤äº†èƒ½å¤Ÿä¿®æ”¹<code>apply</code>æ–¹æ³•çš„å‚æ•°ä»¥å¤–, æˆ‘ä»¬ä»€ä¹ˆä¹Ÿåšä¸äº†, é‚£ä¹ˆå¦‚æœæˆ‘ä»¬æƒ³ç»™ä»–å¢åŠ æ‰©å±•èƒ½åŠ›,æˆ‘ä»¬åº”è¯¥æ€ä¹ˆåŠå‘¢?</p>
<h2 id="æ’ä»¶çš„å¼•å…¥"><a href="#æ’ä»¶çš„å¼•å…¥" class="headerlink" title="æ’ä»¶çš„å¼•å…¥"></a>æ’ä»¶çš„å¼•å…¥</h2><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦è®¾è®¡ä¸€ä¸ªæ’ä»¶å¼•ç”¨çš„æ–¹å¼, æ’ä»¶çš„å¼•å…¥ä¸€èˆ¬æœ‰ä¸¤ç§æ–¹æ³•, ä¸€ç§æ˜¯é€šè¿‡é…ç½®å£°æ˜çš„æ–¹å¼å¼•å…¥, æ¯”å¦‚webpack, babeléƒ½æ˜¯è¿™æ ·çš„, ä½¿ç”¨çš„æ˜¯å®ƒä»¬çš„configæ–‡ä»¶æ¥å¼•å…¥:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  plugin: [<span class="string">'upperCase-param'</span>, <span class="string">'default-render'</span>],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å¦ä¸€ç§æ˜¯vueè¿™ç§è°ƒç”¨å¼çš„åŠ è½½æ–¹å¼:<br> <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Vue.use(xxx)</span><br></pre></td></tr></table></figure></p>
<p>å®é™…ä¸Šç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªè€…æ²¡æœ‰æœ¬è´¨åŒºåˆ«, æœ€åè¿˜æ˜¯ä¼šå·²ç¬¬äºŒç§çš„å½¢å¼å¯¹æ’ä»¶è¿›è¡Œå¼•å…¥,é‚£ä¹ˆæ—¢ç„¶ä¸¤è€…å®é™…ä¸Šéƒ½ä¸€æ ·, é‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦è‡ªå·±å»å®ç°ä¸€ä¸ªæ’ä»¶çš„åŠ è½½å™¨åŠŸèƒ½</p>
<p>æ’ä»¶åŠ è½½å™¨ä¸€èˆ¬åˆ†æˆæ’ä»¶çš„åŠ è½½å’Œæ’ä»¶çš„è°ƒç”¨ä¸¤ä¸ªéƒ¨åˆ†, æ’ä»¶çš„åŠ è½½å¾ˆç®€å•, æ— éå°±æ˜¯ä¸€ä¸ªæ–¹æ³•æŠŠæ’ä»¶æ³¨å…¥åˆ°Libraryçš„å†…éƒ¨, æ–¹ä¾¿éšæ—¶è°ƒç”¨, ä½†æ˜¯æ’ä»¶çš„è°ƒç”¨ç¡®éè¯šçš„ä¾èµ–æ’ä»¶ç³»ç»Ÿçš„æœ¬èº«è®¾è®¡, æ‰€ä»¥æˆ‘ä»¬æˆ‘ä»¬å…ˆçœ‹çœ‹æ’ä»¶ç³»ç»Ÿé€šå¸¸éƒ½æœ‰å“ªäº›æŠŠ!</p>
<h2 id="å¸¸è§æ’ä»¶ç³»ç»Ÿåˆ†ç±»"><a href="#å¸¸è§æ’ä»¶ç³»ç»Ÿåˆ†ç±»" class="headerlink" title="å¸¸è§æ’ä»¶ç³»ç»Ÿåˆ†ç±»"></a>å¸¸è§æ’ä»¶ç³»ç»Ÿåˆ†ç±»</h2><p>é€šå¸¸æ’ä»¶ç³»ç»Ÿçš„åˆ†ç±»æœ‰: </p>
<ul>
<li>äº‹ä»¶é’©å­å‹ </li>
<li>pipelineçš„æµå¼è°ƒç”¨å‹</li>
<li>è·å–å®ä¾‹å‹</li>
</ul>
<p>é‚£ä¹ˆä¸‹é¢æˆ‘ä»¬åˆ†åˆ«æŒ‰ä¸‰ç§æ–¹å¼æ¥å¯¹æˆ‘ä»¬çš„è¿™ä¸ªè¿™ä¸ªminiLibraryè¿›è¡Œæ’ä»¶åŒ–å§!</p>
<h2 id="äº‹ä»¶é’©å­å‹"><a href="#äº‹ä»¶é’©å­å‹" class="headerlink" title="äº‹ä»¶é’©å­å‹"></a>äº‹ä»¶é’©å­å‹</h2><p><em>ä½¿ç”¨é’©å­æ’ä»¶ç³»ç»Ÿçš„Libraryæœ‰å¾ˆå¤š, <code>webpack</code> <code>babel</code>éƒ½æ˜¯</em></p>
<p>ä»ä»£ç ä¸Šçœ‹, ç¨‹åºæ‰§è¡Œæœ‰å‡ ä¸ªä¸»è¦çš„è¿è¡Œé˜¶æ®µ: <code>apply</code> <code>process</code> <code>render</code> æˆ‘ä»¬åªéœ€è¦åœ¨è¿™å‡ ä¸ªåœ°æ–¹å¢åŠ ç”Ÿå‘½å‘¨æœŸå‡½æ•°, å°±å¯ä»¥å§æŠŠæ‰©å±•çš„èƒ½åŠ›ç»™åˆ°å¤–é¢äº†,è€Œä½ éœ€è¦å®šä¹‰çš„å°±æ˜¯æ¯ä¸ªé’©å­å‡½æ•°èƒ½æ‹¿åˆ°ä»€ä¹ˆå‚æ•°</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DataProcessRender</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;&#125;;</span><br><span class="line">    <span class="keyword">this</span>.plugin = <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  process(a, b) &#123;</span><br><span class="line">    <span class="comment">// å¢åŠ processé’©å­, ç”¨äºå¢åŠ å¤„ç†ç»“æœçš„æ‰©å±•èƒ½åŠ›</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.plugin?.process?.(a, b) || a + b;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  apply(a, b, targetDom) &#123;</span><br><span class="line">    <span class="comment">// applyé’©å­, å¯ä»¥æ‰©å±•åˆå§‹åŒ–æ•°æ®</span></span><br><span class="line">    <span class="keyword">const</span> [_a, _b, _targetDom] = <span class="keyword">this</span>.plugin?.onApply?.(a, b, targetDom);</span><br><span class="line">    <span class="keyword">this</span>.state &#123;</span><br><span class="line">      a: _a,</span><br><span class="line">      b: _b,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">this</span>.targetDom = _targetDom;</span><br><span class="line">    <span class="keyword">this</span>.render();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="comment">// runderé’©å­, ç”¨äºä¿®æ”¹renderçš„èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">const</span> dom = <span class="keyword">this</span>.plugin?.onRender?.(<span class="built_in">document</span>.querySelector(<span class="keyword">this</span>.state.targetDom), <span class="keyword">this</span>.targetDom);</span><br><span class="line">    dom.innerHtml = process(<span class="keyword">this</span>.state.a, <span class="keyword">this</span>.state.b);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  use(plugin) &#123;</span><br><span class="line">    <span class="keyword">this</span>.plugin = plugin;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è°ƒç”¨çš„æ–¹æ³•:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> plugin = &#123;</span><br><span class="line">  onApply: <span class="function">(<span class="params">a ,b ,targetDom</span>) =&gt;</span> [a.toUpperCase(), b.toUpperCase(), targetDom];</span><br><span class="line">  onProcess: <span class="function">(<span class="params">a, b</span>) =&gt;</span> a + <span class="string">' '</span> + b + <span class="string">' some extend text'</span>;</span><br><span class="line">  onRender: <span class="function">(<span class="params">dom</span>) =&gt;</span> dom || <span class="built_in">document</span>.querySelector(<span class="string">'#defaultDom'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> render = <span class="keyword">new</span> DateProcessRender()</span><br><span class="line">render.use(plugin);</span><br><span class="line">render.apply(<span class="string">'hello'</span>, <span class="string">' world!!'</span>, <span class="string">'#app'</span>); <span class="comment">// HELLO WORLD!! some extend text</span></span><br></pre></td></tr></table></figure></p>
<p>ä»¥ä¸Šè¿™ç§æ˜¯ä½¿é€šè¿‡ä¸åŒçš„å‘¨æœŸå‡½æ•°æ¥æŠŠæ–°çš„é€»è¾‘å€¼å…¥åˆ°å¯¹åº”çš„é˜¶æ®µ, å†ä¸åŒçš„é˜¶æ®µå¯¹æ•°æ®åšä¸åŒç¨‹åº¦çš„ä¿®æ”¹, è¿™çœ‹ä¸Šå»æ˜¯ä¸æ˜¯å¾ˆåƒå†™reactç»„ä»¶?å®é™…ä¸Šä½ ä¹Ÿå¯ä»¥å§æ¯ä¸€ä¸ªreactçš„componentçœ‹æˆreactçš„æ’ä»¶, è€ŒReactåªæ˜¯ä¸€ä¸ªè°ƒç”¨å™¨</p>
<p>è¿™ç§è®¾è®¡æ’ä»¶çš„æ–¹å¼å±äºå…¸å‹çš„å£°æ˜å¼çš„ç¼–ç¨‹, ä»£ç çš„å¯è¯»æ€§æ¯”è¾ƒå¼º, å¾ˆå®¹æ˜“å†é˜…è¯»æ’ä»¶æºç çš„æ—¶å€™ææ¸…æ¥šæ¥é¾™å»è„‰, å¹¶ä¸”å¯¹æ’ä»¶çš„èƒ½åŠ›åšå‡ºäº†æœ‰æ•ˆçš„æ§åˆ¶. ä¸è¿‡å¯¹æ’ä»¶èƒ½åŠ›çš„æ§åˆ¶è¯•ä¸€æŠŠåŒåˆƒå‰‘, åŠå‡å°‘äº†ä¸è‰¯æ’ä»¶å¯¹libraryçš„å½±å“, ä¹ŸåŒæ—¶ä»£è¡¨æ’ä»¶çš„æ‰©å±•èƒ½åŠ›æ²¡æœ‰é‚£ä¹ˆå¼ºå¤§</p>
<h2 id="pipelineçš„æµå¼è°ƒç”¨å‹"><a href="#pipelineçš„æµå¼è°ƒç”¨å‹" class="headerlink" title="pipelineçš„æµå¼è°ƒç”¨å‹"></a>pipelineçš„æµå¼è°ƒç”¨å‹</h2><p><em>ä½¿ç”¨pipelineçš„æ–¹å¼æ¥è¿›è¡Œæ‰©å±•, å…¸å‹çš„åº”ç”¨æœ‰webpack loader å’Œ expressçš„ä¸­é—´ä»¶.</em></p>
<p>ä¸€æ¬¡è°ƒç”¨ä¸€ä¸ªplugin, ä»¥ç±»ä¼¼æµæ°´çº¿çš„æ–¹å¼å‡»é¼“ä¼ èŠ±å¯¹æ•°æ®è¿›è¡Œæ“ä½œ, æœ€åå¯¹æ•°æ®åšå‡ºå“åº”çš„æ‰©å±•æ–¹æ¡ˆ, ä¸€ä¸ªä¸ªå…³è”çœ‹ä¼¼ä¸å¤§çš„æ’ä»¶, å°±è¿™ä¹ˆç»„åˆå‡ºä¸€ä¸ªå¼ºå¤§çš„åŠŸèƒ½</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DataProcessRender</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;&#125;;</span><br><span class="line">    <span class="keyword">this</span>.plugins = []; </span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  apply(a, b, targetDom) &#123;</span><br><span class="line">    <span class="keyword">this</span>.state &#123;</span><br><span class="line">      a,</span><br><span class="line">      b,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.targetDom = targetDom;</span><br><span class="line">    run();</span><br><span class="line">  &#125;</span><br><span class="line">  process() &#123;</span><br><span class="line">    data.result = data.a + <span class="string">''</span> + data.b; </span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="built_in">document</span>.querySelector(<span class="keyword">this</span>.state.targetDom).innerHtml(<span class="keyword">this</span>.state.result)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  run() &#123;</span><br><span class="line">    <span class="keyword">this</span>.process();</span><br><span class="line">    <span class="keyword">let</span> index = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">const</span> context = &#123;</span><br><span class="line">      data: <span class="keyword">this</span>.state;</span><br><span class="line">      targetDom: <span class="keyword">this</span>.targetDom;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è¿™é‡Œåªæ”¯æŒäº†åŒæ­¥çš„è°ƒç”¨</span></span><br><span class="line">    <span class="keyword">const</span> next = <span class="function"><span class="params">()</span> =&gt;</span> plugins.length &lt; index + <span class="number">1</span> ? <span class="keyword">this</span>.plugins[index](context, next);</span><br><span class="line">    <span class="comment">// ä¾æ¬¡è°ƒç”¨æ’ä»¶, è¿›è¡Œæ•°æ®å¤„ç†</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.plugins.length) &#123;</span><br><span class="line">      <span class="keyword">this</span>.plugins[index](context, next);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.render();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  use(plugin) &#123;</span><br><span class="line">    <span class="keyword">this</span>.plugins.push(plugin);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è°ƒç”¨çš„æ–¹æ³•:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pluginA = <span class="function">(<span class="params">context, next</span>) =&gt;</span>  &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; data &#125; = context;</span><br><span class="line">  data.a = data.a.toUpperCase(); </span><br><span class="line">  data.b = data.a.toUpperCase(); </span><br><span class="line">  next()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> pluginB = <span class="function">(<span class="params">context, next</span>) =&gt;</span>  &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; data &#125; = context;</span><br><span class="line">  data.result =  data.a + <span class="string">' '</span> + dat.b + <span class="string">' some extend text'</span>;</span><br><span class="line">  next()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> pluginC = <span class="function">(<span class="params">context, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="built_in">document</span>.querySelector(contest.targetDom)) &#123;</span><br><span class="line">    context = <span class="string">'#defaultDom'</span>; </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> render = <span class="keyword">new</span> DateProcessRender()</span><br><span class="line"><span class="comment">// æ³¨å†Œ</span></span><br><span class="line">render.use(pluginA);</span><br><span class="line">render.use(pluginB);</span><br><span class="line">render.use(pluginC);</span><br><span class="line">render.apply(<span class="string">'hello'</span>, <span class="string">' world!!'</span>, <span class="string">'#app'</span>); <span class="comment">// HELLO WORLD!! some extend text</span></span><br></pre></td></tr></table></figure></p>
<p>ä¸Šé¢æ•…æ„å¤šäº›å‡ ä¸ªä¾‹å­æ˜¯ä¸ºäº†è®©æ¯ä¸ªæ’ä»¶çš„èŒè´£å•ä¸€, å®é™…ä¸Šè¿™ä¹Ÿç€è¿™ç±»pipelineæ’ä»¶çš„ç‰¹ç‚¹, æ¯”è¾ƒå®¹æ˜“å†™å‡ºèŒè´£å•ä¸€çš„æ’ä»¶, æ–¹ä¾¿åœ¨åç»­çš„ä½¿ç”¨ä¸­è¿›è¡Œæœ‰æ•ˆçš„ç»„åˆå·²ç»å¤ç”¨. åŒæ—¶è¿™ç§æ–¹å¼ä¹Ÿèƒ½æ¯”è¾ƒå¥½çš„æ§åˆ¶ä½æ’ä»¶çš„èƒ½åŠ›,ä½ åªéœ€è¦æŠŠå¸Œæœ›æ’ä»¶æ§åˆ¶çš„å±æ€§ä¼ ç»™ä»–å³å¯</p>
<h2 id="è·å–å®ä¾‹å‹"><a href="#è·å–å®ä¾‹å‹" class="headerlink" title="è·å–å®ä¾‹å‹"></a>è·å–å®ä¾‹å‹</h2><p><em>è·å–å®ä¾‹çš„æ’ä»¶ç³»ç»Ÿä¹Ÿæœ‰å¾ˆå¤šLibraryåœ¨ä½¿ç”¨, <code>jQuery</code> <code>Vue</code></em><br>è·å–å®ä¾‹çš„æ–¹å¼, å¯ä»¥è®©æ’ä»¶ç›´æ¥æ‹¿åˆ°Libraryçš„å®ä¾‹, ä¹Ÿå°±ä»¥ä¸ºè¿™ä»–èƒ½æ‹¿åˆ°å‡ ä¹æ‰€æœ‰çš„æ•°æ®, å’Œç›´æ¥æ”¹æºç æ•ˆæœå·®ä¸å¤š, éå¸¸çš„å¼ºå¤§ç²—æš´<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DataProcessRender</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;&#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  process(a, b) &#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  apply(a, b, targetDom) &#123;</span><br><span class="line">    <span class="keyword">this</span>.state &#123;</span><br><span class="line">      a,</span><br><span class="line">      b,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">this</span>.targetDom = targetDom;</span><br><span class="line">    <span class="keyword">this</span>.render();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="built_in">document</span>.querySelector(<span class="keyword">this</span>.state.targetDom).innerHtml = process(<span class="keyword">this</span>.state.a, <span class="keyword">this</span>.state.b);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  use(plugin) &#123;</span><br><span class="line">    plugin(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è°ƒç”¨çš„æ–¹æ³•:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> plugin(instance) &#123;</span><br><span class="line">  instance.process = <span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a.toUpperCase() + <span class="string">' '</span> + b.toUpperCase() + <span class="string">' some extend text'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  instance.render() &#123;</span><br><span class="line">    <span class="keyword">const</span> dom = <span class="built_in">document</span>.querySelector(<span class="keyword">this</span>.state.targetDom) || <span class="built_in">document</span>.querySelector(<span class="string">'#defaultDom'</span>)</span><br><span class="line">    dom.innerHtml = process(<span class="keyword">this</span>.state.a, <span class="keyword">this</span>.state.b);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> render = <span class="keyword">new</span> DateProcessRender()</span><br><span class="line">render.use(pluginA);</span><br><span class="line">render.apply(<span class="string">'hello'</span>, <span class="string">' world!!'</span>, <span class="string">'#app'</span>); <span class="comment">// HELLO WORLD!! some extend text</span></span><br></pre></td></tr></table></figure></p>
<p>è¿™ç§æ–¹æ³•æ˜¾ç„¶æ˜¯è¿™ä¸‰ç§å½“ä¸­æœ€ç›´æ¥ç²—æš´çš„ç­–ç•¥, ç»™æ’ä»¶æä¾›äº†éå¸¸éå¸¸å¼ºå¤§çš„èƒ½åŠ›, ç”¨è¿™ç§æ–¹å¼, ä½ å¯ä»¥ç”¨å¾ˆå¤šç§å®ç°æˆ‘ä»¬éœ€è¦çš„åŠŸèƒ½, ä½†æ˜¯å¼ºå¤§çš„èƒ½åŠ›å¸¦ç»™æˆ‘ä»¬çš„æ˜¯æ›´å¤šçš„é£é™©. æˆ‘ä»¬éœ€è¦å»å°å¿ƒæ’ä»¶äº§ç”Ÿçš„å‰¯ä½œç”¨ä»¥åŠæ›´é™¡å³­çš„æ’ä»¶å¼€å‘å­¦ä¹ æ›²çº¿. å› ä¸ºä½ å¯ä»¥è·å¾—æ•´ä¸ªå®ä¾‹çš„æ‰€æœ‰æ•°æ®. ä½ ä¸ä»…ä»…å¯ä»¥è¯»å–å®ä¾‹æ‰€æœ‰æ•°æ®, ä½ è¿˜å¯ä»¥ç»™å®ä¾‹å¢åŠ æ–°çš„æ–¹æ³•å’Œå±æ€§, ä½†æ˜¯è¿™éƒ½éœ€è¦åˆä¸€ä¸ªå‰æ, ä½ å¯¹libraryçš„æºç è¦äº†è§£çš„è¶³å¤Ÿå¤š, ä»¥é˜²ä½ ä¸å°å¿ƒè¦†ç›–äº†libraryçš„åŸç”Ÿæ–¹æ³•å’Œå±æ€§å¯¼è‡´äº†æœªçŸ¥çš„é”™è¯¯</p>
<p>åŒæ—¶è™½ç„¶æœ‰å¾ˆå¥½çš„æ‰©å±•èƒ½åŠ›, ä½†æ˜¯å¤šä¸ªæ’ä»¶ä¹‹é—´éå¸¸ä¸å®¹æ˜“ç›¸äº’é…åˆ, å¹¶ä¸”æ’ä»¶çš„ç¼–å†™æ²¡ä»€ä¹ˆè§£æ„è°ƒç†, è®©é˜…è¯»ä»£ç ä¸Šè®©äººæ„Ÿåˆ°åƒåŠ›</p>
<h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>é¦–å…ˆå¾—è¯´æ˜ä¸€ä¸‹, ä¸Šé¢çš„ä¾‹å­éƒ½éå¸¸çš„ç®€é™‹, åªæ˜¯ä¸ºäº†è¯´æ˜æ¦‚å¿µè€Œè®¾è®¡çš„, å®é™…ä¸Šçš„æ­£è§„é¡¹ç›®, è¿™äº›æ–¹æ¡ˆä¼šå¤æ‚å¾ˆå¤š, è¿™é‡Œä»…ä»…ä½œä¸ºæŠ›ç –å¼•ç‰.</p>
<p>é‚£ä¹ˆé—®é¢˜æ¥äº†, ä»¥ä¸Šä¸‰ç§æ’ä»¶æ¨¡å¼åˆ°åº•å“ªä¸€ç§å¥½? åœ¨æˆ‘çœ‹æ¥ä»–ä»¬å„æœ‰å„çš„ç‰¹ç‚¹, æ²¡æœ‰åŠæ³•è¯´å‡ºå…·ä½“å“ªä¸ªå¥½, åªèƒ½æ˜¯å„æœ‰åƒç§‹, ä»¥åŠèƒ½åŠ›ä¸Šçš„å–èˆè€Œå·², å®é™…ä¸Šç¤¾åŒºé‡Œçš„å„å¤§Libraryä¹Ÿå¹¶éæ˜¯åŒæ—¶åªåœ¨ä½¿ç”¨ä¸€ä¸ªæ¨¡å¼, ä»–ä»¬å¾€å¾€æ˜¯ç›¸äº’ä½¿ç”¨çš„, å¯èƒ½åŒæ—¶å­˜åœ¨åŠä½¿ç”¨é’©å­, åˆä½¿ç”¨ç»§æ‰¿, æ—¢ä½¿ç”¨ç»§æ‰¿, åˆä½¿ç”¨pipeline. æ¯”å¦‚webpack,ä»–å°±æ˜¯æŠŠè¿™ä¸‰ç§æ–¹å¼è¿›è¡Œäº†èåˆ, æ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥çœ‹æˆ‘ä¹‹å‰çš„åšæ–‡.</p>
<p>å›åˆ°å¼€å¤´çš„é—®é¢˜ä¸Šæ¥, æˆ‘ä»¬èƒ½ä»è¿™äº›æ’ä»¶ç³»ç»Ÿæ¨¡å¼ä¸Šå­¦åˆ°ä»€ä¹ˆ? æˆ‘è§‰å¾—æ˜¯è®©ä¸€ä¸ªä¸ªçœ‹ä¼¼é»‘ç®±çš„Libraryæ›´åŠ é€æ˜, è®©å†™ä¸€ä¸ªæ’ä»¶æ„Ÿè§‰å¹¶æ²¡æœ‰é‚£ä¹ˆäº‘é‡Œé›¾é‡Œ, è®©æˆ‘ä»¬åœ¨å†™ä»£ç çš„æ—¶å€™èƒ½å¤ŸçŸ¥å…¶ç„¶ä¹Ÿèƒ½çŸ¥å…¶æ‰€ä»¥ç„¶.</p>
<h2 id="é“¶å¼¹"><a href="#é“¶å¼¹" class="headerlink" title="é“¶å¼¹?"></a>é“¶å¼¹?</h2><p>æ’ä»¶ç³»ç»Ÿçš„è®¾è®¡æœ‰æ²¡æœ‰é“¶å¼¹å‘¢? æˆ‘è§‰å¾—æ²¡æœ‰, ä½†æ˜¯ä¼šæœ‰ä¸€äº›å¾ˆå¥½çš„å®è·µ. </p>
<p>ç›®å‰å¾ˆå¤šLibraryçš„æ’ä»¶ç³»ç»Ÿåšçš„éƒ½ååˆ†åº•å±‚, å¹¶ä¸æ˜¯ç®€ç®€å•å•ä¸­æ¥åšåŠŸèƒ½æ‰©å±•çš„, è€Œæ˜¯ä¸€ä¸ªå®Œæ•´çš„è¿è¡Œæ¶æ„. æ‰€ä»¥çš„libraryå†…ç½®åŠŸèƒ½éƒ½æ˜¯åŸºäºæ’ä»¶æ¥å¼€å‘çš„, æ¯”å¦‚babel-core åªæ˜¯åšä»£ç åˆ°astå†åˆ°ä»£ç çš„è½¬æ¢, å¤§æ¦‚æ˜¯è¿™æ ·: <code>(a) =&gt; a</code>, æ‰€æœ‰çš„è¯­æ³•è½¬æ¢éƒ½æ˜¯åŸºäºä¸€ä¸ªä¸ªçš„æ’ä»¶æ¥è¿›è¡Œç‰¹å®šè¯­æ³•çš„è½¬ç§»<br>è¿˜æœ‰å°±æ˜¯webpackçš„æ„å»ºè¿è¡Œæ—¶, ä»æ„å»ºå¯åŠ¨, åˆ°æ–‡ä»¶ç”Ÿæˆ, éƒ½æ˜¯ä¸€ç³»åˆ—çš„å£°æ˜å‘¨æœŸé’©å­çš„è°ƒç”¨.å‡ ä¹95%çš„æ‰“åŒ…å®ç°éƒ½æ˜¯ç”±ä¸åŒçš„æ’ä»¶æ¥å®ç°çš„. </p>
<p>å¯ä»¥å§babel-core webpack-runtime æƒ³è±¡æˆæˆ‘ä»¬å¼€å‘ä½¿ç”¨çš„react, æ‰€è°“çš„LibraryåŠŸèƒ½, å°±æ˜¯æˆ‘ä»¬å†™çš„reacté¡¹ç›®, å¯ä»¥è¯´åŠŸèƒ½æ’ä»¶åŒ–è¿™æ˜¯æœªæ¥å¤§å‹Libraryè®¾è®¡è¶‹åŠ¿, </p>
<h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>æ’ä»¶ç³»ç»Ÿåº”è¯¥è¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„æ–¹æ³•è®º, å¦‚æœæˆ‘åœ¨ä¹‹ååˆçœ‹åˆ°æ–°é²œçš„æ–¹æ¡ˆ, ä¼šç¬¬ä¸€æ—¶é—´åˆ†äº«å‡ºæ¥.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/03/29/å¦‚ä½•è®¾è®¡ä¸€ä¸ªæ’ä»¶ç³»ç»Ÿ/" data-id="ck9ik1ty0000awhrohgba5ie8" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-æ·±å…¥webpack-æ’ä»¶" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/01/31/æ·±å…¥webpack-æ’ä»¶/" class="article-date">
  <time datetime="2020-01-31T02:11:46.000Z" itemprop="datePublished">2020-01-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/01/31/æ·±å…¥webpack-æ’ä»¶/">æ·±å…¥webpack-æ’ä»¶</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><code>webpack</code>ç›®å‰æ˜¯å‰ç«¯æ‰“åŒ…å·¥å…·ä½¿ç”¨æœ€å¤šçš„å·¥å…·, è¿™ä¸ä»…ä»…æ˜¯å› ä¸ºå®ƒæœ‰éå¸¸å¥½çš„æ‰“åŒ…æ€§èƒ½, è¿˜åº”ä¸ºå®ƒå…·å¤‡éå¸¸å¼ºçš„æ‰©å±•æ€§,å¯ä»¥ä¸ºä¸åŒçš„åœºæ™¯è¿›è¡ŒåŠŸèƒ½çš„æ‰©å±•.</p>
<p>å¦‚æœæˆ‘ä»¬å»æµè§ˆä¸€ä¸‹<code>webpack</code>çš„æºç , æˆ‘ä»¬ä¼šå‘ç°<code>webpack</code>æºç é‡Œæœ‰äº†éå¸¸éå¸¸å¤šçš„æ’ä»¶,åœ¨çœ‹è¿‡ä¸€éƒ¨åˆ†<code>webpack</code>æºç åä½ ä¼šå‘ç°, å®é™…ä¸Š<code>webpack</code>çš„æ‰€æœ‰åŠŸèƒ½éƒ½æ˜¯ç”¨ä¸€ä¸ªä¸€ä¸ªæ’ä»¶å †ç Œå‡ºæ¥çš„.ä¸‹é¢æˆ‘ä»¬å…ˆè®²ä¸€è®²<code>webpack</code>æ’ä»¶çš„æ ¸å¿ƒé€»è¾‘åˆ°åº•æ˜¯ä»€ä¹ˆ.</p>
<h2 id="æ‰“åŒ…çš„ä¸»è¦æµç¨‹"><a href="#æ‰“åŒ…çš„ä¸»è¦æµç¨‹" class="headerlink" title="æ‰“åŒ…çš„ä¸»è¦æµç¨‹"></a>æ‰“åŒ…çš„ä¸»è¦æµç¨‹</h2><p>æˆ‘ä»¬æŠŠ<code>webpack</code>çš„æ„å»ºè¿‡ç¨‹æƒ³è±¡æˆæ˜¯ä¸€ä¸ªæœ‰å¤§é‡ç”Ÿå‘½å‘¨æœŸçš„ä¸€ä¸ªMVVMå‰ç«¯ç»„ä»¶, ä»ç»„ä»¶åˆå§‹åŒ–åˆ°æˆåŠŸçš„æ¸²æŸ“çš„é¡µé¢ä¸Šä¼šè§¦å‘å¤šä¸ªç”Ÿå‘½å‘¨æœŸ, åœ¨ä¸åŒçš„ç”Ÿå‘½å‘¨æœŸæ¥ä¼šè§¦å‘ä¸åŒçš„å›è°ƒå‡½æ•°,è€Œå›è°ƒå‡½æ•°å¯ä»¥è®¿é—®åˆ°ç»„ä»¶çš„å†…éƒ¨çŠ¶æ€.</p>
<p><code>webpack</code>åœ¨æ¯ä¸€æ¬¡æ„å»ºçš„æ—¶å€™ä¼šç”Ÿæˆä¸€ä¸ª<code>compiler</code>å¯¹è±¡, è¿™ä¸ªå¯¹è±¡å°±ç±»ä¼¼äºä¸€ä¸ªç»„ä»¶å®ä¾‹, æ‰€æœ‰çš„ç”Ÿå‘½å‘¨æœŸéƒ½æ˜¯å¯¹è¿™ä¸ª<code>compiler</code>å¯¹è±¡çš„çŠ¶æ€æè¿°.<code>compiler</code>å¯¹è±¡ä¼šä¾æ¬¡è§¦å‘å®ƒä¸Šé¢çš„æ¯ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸ, åªä¸è¿‡åœ¨<code>webpack</code>é‡Œæˆ‘ä»¬ä¸å«å®ƒç”Ÿå‘½å‘¨æœŸ, å«åš<strong>é’©å­</strong></p>
<p><code>webpack</code>é‡Œæ‰€æœ‰çš„å¯¹è±¡å‡ ä¹éƒ½æ˜¯ç”±ç±»æ¥ç”Ÿæˆçš„, è€Œé’©å­å°±æ˜¯åœ¨ç±»çš„<code>constructor</code>æ–¹æ³•ä¸­è¿›è¡Œåˆå§‹åŒ–. çœ‹è¿‡ä¸Šä¸€ç¯‡å¯¹tapableä»‹ç»çš„åŒå­¦åº”è¯¥çŸ¥é“, è¿™é‡Œåœ¨å¤§æ¦‚è¯´ä¸€ä¸‹:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Compiler</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(context) &#123;</span><br><span class="line">    <span class="keyword">this</span>.hook = &#123;</span><br><span class="line">      <span class="comment">/** @type &#123;SyncBailHook&lt;[string, Entry], boolean&gt;&#125; å¤„ç†webpack config option */</span></span><br><span class="line">      entryOption: <span class="keyword">new</span> SyncBailHook([<span class="string">"context"</span>, <span class="string">"entry"</span>])</span><br><span class="line">      <span class="comment">/** @type &#123;AsyncSeriesHook&lt;[Compiler]&gt;&#125; æ­£å¼å¼€å§‹ */</span></span><br><span class="line">      run: <span class="keyword">new</span> AsyncSeriesHook([<span class="string">"compiler"</span>]),</span><br><span class="line">      <span class="comment">/** @type &#123;SyncHook&lt;[CompilationParams]&gt;&#125; ç¼–è¯‘ */</span></span><br><span class="line">      compile: <span class="keyword">new</span> SyncHook([<span class="string">"params"</span>]),</span><br><span class="line">      <span class="comment">/** @type &#123;SyncHook&lt;[Compilation, CompilationParams]&gt;&#125; ç”Ÿæˆ compilation */</span></span><br><span class="line">      compilation: <span class="keyword">new</span> SyncHook([<span class="string">"compilation"</span>, <span class="string">"params"</span>]),</span><br><span class="line">      <span class="comment">/** @type &#123;AsyncParallelHook&lt;[Compilation], Module&gt;&#125; ç”Ÿæˆä¾èµ–æ ‘ */</span></span><br><span class="line">      make: <span class="keyword">new</span> AsyncParallelHook([<span class="string">"compilation"</span>]),</span><br><span class="line">      <span class="comment">/** @type &#123;AsyncSeriesHook&lt;[Compilation]&gt;&#125; å†™å…¥æ–‡ä»¶ç³»ç»Ÿ */</span></span><br><span class="line">      emit: <span class="keyword">new</span> AsyncSeriesHook([<span class="string">"compilation"</span>]),</span><br><span class="line">      <span class="comment">/** @type &#123;AsyncSeriesHook&lt;[Stats]&gt;&#125; å®Œæˆ */</span></span><br><span class="line">      done: <span class="keyword">new</span> AsyncSeriesHook([<span class="string">"stats"</span>]),</span><br><span class="line">      <span class="comment">/** @type &#123;SyncHook&lt;[Error]&gt;&#125; å¤±è´¥ */</span></span><br><span class="line">      failed: <span class="keyword">new</span> SyncHook([<span class="string">"error"</span>]),</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä¸Šé¢åˆ—å‡ºçš„é’©å­å¹¶ä¸æ˜¯æ‰€æœ‰çš„,åšäº†å¾ˆå¤§çš„ç²¾ç®€, ä¹¦å†™é¡ºåºåˆè°ƒç”¨é¡ºåºä¸€è‡´,<a href="https://webpack.docschina.org/api/compiler-hooks/" target="_blank" rel="noopener">compileré’©å­å®Œæ•´åˆ—è¡¨</a></p>
<h2 id="å¦‚ä½•ä½¿ç”¨é’©å­"><a href="#å¦‚ä½•ä½¿ç”¨é’©å­" class="headerlink" title="å¦‚ä½•ä½¿ç”¨é’©å­"></a>å¦‚ä½•ä½¿ç”¨é’©å­</h2><p>é‚£ä¹ˆåœ¨å®ä¾‹åŒ–<code>Compiler</code>åç”Ÿæˆäº†å¯¹è±¡<code>compiler</code>,å½“æˆ‘ä»¬æ‹¿åˆ°compilerå¯¹è±¡å, æˆ‘ä»¬å°±å¯ä»¥ä¸ºcompilerå¯¹è±¡ä¸Šé¢çš„å„ç§é’©å­æ·»åŠ å¯¹åº”çš„å›è°ƒå‡½æ•°.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> compiler = <span class="keyword">new</span> Compiler();</span><br><span class="line">compiler.hooks.compilation.tap(<span class="string">'pluginName'</span>, (compilation, params) =&gt; &#123;</span><br><span class="line">  <span class="comment">// é€šè¿‡å¯¹ç»™å¯¹åº”çš„é’©å­æ·»åŠ å›è°ƒå‡½æ•°, åœ¨å›è°ƒå‡½æ•°æ‰§è¡Œæ—¶,å°±å¯ä»¥æ‹¿åˆ°å¯¹åº”çš„å¯¹è±¡</span></span><br><span class="line">  <span class="comment">// æ³½è¾‰è¿™ä¸ªé’©å­é‡Œ, æˆ‘ä»¬å¯ä»¥æ‹¿åˆ°compilationå¯¹è±¡</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>çœ‹ä¸Šå»è½½ä¸€ä¸ªé’©å­ä¸Šæ·»åŠ å›è°ƒå‡½æ•°æ˜¯æ˜¯éå®¹æ˜“çš„. ä½†æ˜¯é—®é¢˜æ¥äº†, æˆ‘ä»¬æ€æ ·æ‰èƒ½è·å–åˆ°compilerå¯¹è±¡å‘¢? è¿™é‡Œwebpackæ’ä»¶å°±éœ€è¦ç™»åœºäº†</p>
<h2 id="å¦‚ä½•å†™ä¸€ä¸ªæ’ä»¶"><a href="#å¦‚ä½•å†™ä¸€ä¸ªæ’ä»¶" class="headerlink" title="å¦‚ä½•å†™ä¸€ä¸ªæ’ä»¶"></a>å¦‚ä½•å†™ä¸€ä¸ªæ’ä»¶</h2><p>å®˜æ–¹çš„pluginç¤ºä¾‹æ˜¯è¿™æ ·çš„:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Plugin</span> </span>&#123;</span><br><span class="line">  apply(compiler) &#123;</span><br><span class="line">    <span class="comment">// è·å¾—compileräº†!</span></span><br><span class="line">    compiler.hooks.compilation.tap(<span class="function">(<span class="params">compilation, params</span>) =&gt;</span> &#123; </span><br><span class="line">      ...</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>åœ¨å®šä¹‰å¥½pluginå, åœ¨webpackçš„configæ–‡ä»¶ä¸­å¼•å…¥è¿™ä¸ªplugin, å¹¶åœ¨å¯¹åº”ä½ç½®è°ƒç”¨:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Plugin = <span class="built_in">require</span>(<span class="string">'./Plugin.js'</span>);</span><br><span class="line"><span class="built_in">module</span>.export = &#123;</span><br><span class="line">  ...</span><br><span class="line">  plugins: [<span class="keyword">new</span> Plugin()],</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>é‚£ä¹ˆæˆ‘ä»¬è‡ªå®šä¹‰çš„pluginæ˜¯å¦‚ä½•è°ƒç”¨,åœ¨ä»€ä¹ˆæ—¶å€™æ³¨å…¥åˆ°<code>compiler</code>é‡Œçš„å‘¢?æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹åˆå§‹åŒ–<code>compiler</code>çš„ä»£ç , æˆ‘ä»¬å‘ç°åœ¨ç”Ÿæˆ<code>compiler</code>çš„æ—¶å€™:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> createCompiler = <span class="function"><span class="params">options</span> =&gt;</span> &#123;</span><br><span class="line">  options = <span class="keyword">new</span> WebpackOptionsDefaulter().process(options);</span><br><span class="line">  <span class="comment">// ç”Ÿæˆä¸€ä¸ªcompilerå¯¹è±¡</span></span><br><span class="line">  <span class="keyword">const</span> compiler = <span class="keyword">new</span> Compiler(options.context);</span><br><span class="line">  <span class="comment">// ä¾æ¬¡è°ƒç”¨æ’ä»¶</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(options.plugins)) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> plugin <span class="keyword">of</span> options.plugins) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> plugin === <span class="string">"function"</span>) &#123;</span><br><span class="line">        plugin.call(compiler, compiler);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        plugin.apply(compiler);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>ä»ä¸Šé¢çš„æºç æˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ¥, æ’ä»¶ä»…ä»…å¯ä»¥æ˜¯ä¸€ä¸ªç±», ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°, ä½¿ç”¨æ–¹æ³•å¤§æ¦‚æ˜¯:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨functionçš„æ–¹å¼æŒ‚è½½æ’ä»¶</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">plugin</span>(<span class="params">compiler</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// è·å¾—compileräº†!</span></span><br><span class="line">  compiler.hooks.compilation.tap(<span class="function">(<span class="params">compilation, params</span>) =&gt;</span> &#123; </span><br><span class="line">    ...</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">module</span>.export = &#123;</span><br><span class="line">  ...</span><br><span class="line">  plugins: [plugin],</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è¿˜æœ‰ä¸€ç§æŒ‚è½½æ’ä»¶çš„æ–¹å¼æ˜¯åœ¨ä½¿ç”¨<code>node</code> apiæ¥è°ƒç”¨<code>webpack()</code>æ‰“åŒ…çš„æ—¶å€™, åœ¨æ‹¿åˆ°è¿”å›çš„<code>compiler</code>å¯¹è±¡å,æ‰‹åŠ¨è°ƒç”¨æ’ä»¶:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Plugin = <span class="built_in">require</span>(<span class="string">'./Plugin.js'</span>);</span><br><span class="line"><span class="keyword">const</span> compiler = webpack(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// æ‰‹åŠ¨è°ƒç”¨æ’ä»¶</span></span><br><span class="line">(<span class="keyword">new</span> Plugin()).apply(compiler);</span><br></pre></td></tr></table></figure></p>
<p>ä¸è¿‡è¿™ç§æ–¹æ³•å¹¶ä¸é€‚ç”¨ä¸æ‰€æœ‰çš„åœºæ™¯, å› ä¸ºåœ¨è°ƒç”¨webpackçš„è¿‡ç¨‹ä¸­,ä¼šæœ‰ä¸€äº›é’©å­å·²ç»è¿è¡Œå®Œæ¯•, å¹¶ä¸æ¨è.</p>
<p>ä¸Šé¢çš„å‡ ä¸ªæ’ä»¶å£°æ˜çš„ç¤ºä¾‹éƒ½ä½¿ç”¨çš„æ˜¯<code>compilation</code>é’©å­, å›è°ƒå‡½æ•°ç§å¯ä»¥æ‹¿åˆ°ä¸€ä¸ª<code>compilation</code>å¯¹è±¡, é‚£ä¹ˆå®ƒåˆ°åº•æ˜¯ä»€ä¹ˆå‘¢?</p>
<h2 id="complication"><a href="#complication" class="headerlink" title="complication"></a>complication</h2><p>æ¯ä¸€ä¸ªcompilerå¯¹è±¡ä¼šåœ¨æ„å»ºçš„æ—¶å€™ä¼šç”Ÿæˆä¸€ä¸ªcompilationå¯¹è±¡, ç”¨æ¥ä¿å­˜åœ¨æ•´ä¸ªæ„å»ºè¿‡ç¨‹ä¸­äº§ç”Ÿçš„ä¸åŒæ•°æ®, æ¯”å¦‚è§£ææ¨¡å—çš„ç»“æœç¼“å­˜, ä¾èµ–æ¨¡å—å›¾, ä¾èµ–æ–‡ä»¶å›¾, chunkå›¾ç­‰.compilationå¯¹è±¡ä¼šåœ¨<code>compile</code>ä¹‹åçš„å¤§éƒ¨åˆ†é’©å­å›è°ƒä¸­è·å¾—.</p>
<p>webpackçš„æ•´ä¸ªæ„å»ºè¿‡ç¨‹äº§ç”Ÿçš„æ•°æ®ä¿¡æ¯éƒ½ä¿å­˜åœ¨compilerå¯¹è±¡åˆcompilationå¯¹è±¡ä¸Š,é‚£ä¹ˆæ—¢ç„¶æ’ä»¶èƒ½å¤Ÿæ‹¿åˆ°è¿™ä¸¤ä¸ªå¯¹è±¡è¯´æ˜æ’ä»¶èƒ½å¤Ÿå¯¹webpackçš„å…¨éƒ¨æ„å»ºæµç¨‹è¿›è¡Œå¹²é¢„.äº‹å®ä¸Šä¹Ÿæ˜¯å¦‚æ­¤. webpackçš„æ•´ä¸ªæ ¸å¿ƒåŠŸèƒ½å‡ ä¹éƒ½æ˜¯ç”±å†…éƒ¨ä¸Šç™¾ä¸ªç§æœ‰æ’ä»¶å‘¢ç»„ç»‡è€Œæˆçš„.æ‰€ä»¥è¯´webpackæ’ä»¶çš„æ‰©å±•èƒ½åŠ›æ˜¯éå¸¸å¼ºå¤§çš„.</p>
<p>compilerå’Œcompilationä¹‹é—´çš„å…³ç³»:<br><img src="https://moka-sugar.oss-cn-beijing.aliyuncs.com/img/20200131182933.jpg" alt></p>
<p><code>compilation</code>å¯¹è±¡é‡Œæœ‰å¤§é‡çš„é’©å­, <a href="https://webpack.js.org/api/compilation-hooks/" target="_blank" rel="noopener">å…·ä½“åˆ—è¡¨</a></p>
<h2 id="ä¸€ä¸ªç®€å•çš„ä¾‹å­"><a href="#ä¸€ä¸ªç®€å•çš„ä¾‹å­" class="headerlink" title="ä¸€ä¸ªç®€å•çš„ä¾‹å­"></a>ä¸€ä¸ªç®€å•çš„ä¾‹å­</h2><p>ç°åœ¨æˆ‘ä»¬å¸Œæœ›åœ¨webpackæ„å»ºå®Œæ¯•å,è·å–æ„å»ºæ—¶ä¾èµ–çš„æ‰€æœ‰é¡¹ç›®æ–‡ä»¶.</p>
<p>ç›®å‰çš„æ€è·¯æ˜¯è·å–åˆ°compilationå¯¹è±¡, ä¸Šé¢åº”è¯¥æœ‰æ‰€æœ‰çš„ä¾èµ–æ–‡ä»¶åˆ—è¡¨.</p>
<p>ä¸ºäº†ä¿è¯compilationå¯¹è±¡ä¸Šçš„ä¾èµ–æ–‡ä»¶åˆ—è¡¨æ˜¯å·²ç»æ”¶é›†å®Œæ•´çš„äº†,æ‰€ä»¥æˆ‘ä»¬å†é€‰æ‹©é’©å­çš„æ—¶å€™è¦ç¡®ä¿æ„å»ºè¿‡ç¨‹å·²ç»ç»“æŸ,ä¾èµ–æ”¶é›†å·²ç»å®Œæ¯•çš„é’©å­<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.export = <span class="class"><span class="keyword">class</span> <span class="title">exportDepPlugin</span> </span>&#123;</span><br><span class="line">  apply(compiler) &#123;</span><br><span class="line">    <span class="comment">// emité’©å­ è¯´æ˜æ•´ä¸ªæ„å»ºå·²ç»å®Œæˆ, å‡†å¤‡è¾“å‡ºæ–‡ä»¶,è¿™æ˜¯ä¾èµ–å·²ç»æ”¶é›†å®Œæ¯•</span></span><br><span class="line">    compiler.hooks.emit.tagAsync(<span class="string">'exportDepPlugin'</span>, (compilation) =&gt; &#123;</span><br><span class="line">      <span class="keyword">const</span> _fileDependencies= <span class="built_in">Array</span>.from(compilation.fileDependencies);<span class="comment">// fileDependenciesæ˜¯ä¸€ä¸ªSet</span></span><br><span class="line">    &#125;) </span><br><span class="line">      <span class="comment">// æ’é™¤node_modulesé‡Œçš„æ–‡ä»¶</span></span><br><span class="line">      <span class="keyword">const</span> dep = _fileDependencies.filter(<span class="function">(<span class="params">d</span>) =&gt;</span> !d.includes(<span class="string">'node_modules'</span>));</span><br><span class="line">      <span class="built_in">console</span>.log(dep);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>webpackçš„æ’ä»¶åŠŸèƒ½éå¸¸å¼ºå¤§, å› ä¸ºå®ƒèƒ½å¤Ÿè®¿é—®åˆ°webpackæ„å»ºè¿‡ç¨‹ä¸­çš„ä¸¤ä¸ªæ ¸å¿ƒå¯¹è±¡,å¹¶åšå‡ºå¹²é¢„.è€Œä¸”ä½ ä¹Ÿå¯ä»¥è‡ªå·±ä¸ºè¿™å‡ ä¸ªå¯¹è±¡æ·»åŠ æ–°çš„é’©å­,å¥½è®©å…¶ä»–ç¬¬ä¸‰æ–¹æ’ä»¶æ¥å¯¹ä½ çš„æ’ä»¶è¿›è¡ŒäºŒæ¬¡æ‰©å±•.</p>
<p>webpackçš„è¿™ç§æ’ä»¶æœºåˆ¶å› ä¸ºä½¿ç”¨äº†ç±»ä¼¼å‘å¸ƒè®¢é˜…çš„æ¨¡å¼,åœ¨æˆ‘çœ‹æ¥å®å®åœ¨åœ¨æ˜¯ä¸€ä¸ªåŒåˆƒå‰‘, åœ¨æä¾›äº†å¼ºå¤§çš„æ‰©å±•æ€§çš„åŒæ—¶,ä¹ŸæŠŠç›¸äº’ä¹‹é—´çš„ä»£ç é€»è¾‘éšè—åœ¨äº†æ·±å¤„. åœ¨æŸ¥çœ‹æºç çš„æ—¶å€™é˜»ç¢é‡é‡, æ— æ³•è®©ç¼–è¾‘å™¨è¿›è¡Œä»»ä½•é™æ€åˆ†æ.</p>
<p>æƒ³è¦äº†è§£æ›´å¤šè¿›é˜¶çš„æ’ä»¶ä½¿ç”¨æ–¹æ³•, è¿™è¾¹å»ºè®®è¿˜æ˜¯çœ‹ä¸€äº›webpackæºç , é‡Œé¢æœ‰å¾ˆå¤šéªšæ°”çš„å†™æ³•</p>
<h2 id="æ‰©å±•é˜…è¯»"><a href="#æ‰©å±•é˜…è¯»" class="headerlink" title="æ‰©å±•é˜…è¯»:"></a>æ‰©å±•é˜…è¯»:</h2><p><a href="https://webpack.js.org/api/" target="_blank" rel="noopener">webpack APIæ–‡æ¡£</a></p>
<p><a href="https://github.com/webpack/webpack" target="_blank" rel="noopener">webpack é¡¹ç›®</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/01/31/æ·±å…¥webpack-æ’ä»¶/" data-id="ck9ik1ty5000dwhrosfuosgnw" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-æ·±å…¥webpack-tapableç¯‡" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/12/20/æ·±å…¥webpack-tapableç¯‡/" class="article-date">
  <time datetime="2019-12-20T04:23:10.000Z" itemprop="datePublished">2019-12-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/20/æ·±å…¥webpack-tapableç¯‡/">æ·±å…¥webpack-tapableç¯‡</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>æ‰“ç®—å†™ä¸€äº›webpackç›¸å…³çš„æ–‡ç« , ä»Šå¤©å°±å…ˆæ‰“ä¸ªæ ·</p>
<h3 id="å¼•å­"><a href="#å¼•å­" class="headerlink" title="å¼•å­"></a>å¼•å­</h3><p>è¯´åˆ°webpack, éƒ½çŸ¥é“æ˜¯ä¸€ä¸ªæ‰“åŒ…å·¥å…·, ä»ä¸€ä¸ªå…¥å£å¼€å§‹, éå†æ‰€æœ‰ä¾èµ–, å¹¶æŠŠæ‰€æœ‰æ–‡ä»¶éƒ½æ‰“åŒ…æˆä¸€ä¸ªjsæ–‡ä»¶, webpackåœ¨æ•´ä¸ªæ„å»ºè¿‡ç¨‹ä¸­éœ€è¦åšä¸€ç³»åˆ—çš„å·¥ä½œ, é‚£ä¹ˆå®ƒå¯¹è¿™äº›å¤æ‚çš„å·¥ä½œæ˜¯æ€ä¹ˆç»„ç»‡çš„å‘¢?<br>å½“æˆ‘ä»¬å»çœ‹webpackæºç çš„æ—¶å€™, ä¼šå‘ç°webpackåœ¨åˆå§‹åŒ–çš„æ—¶å€™è°ƒç”¨äº†å¤§é‡çš„æ²¡ç”¨è¿‡çš„pluginæ¥ç»™compileræä¾›å„ç§èƒ½åŠ›, è®©äººçœ¼èŠ±ç¼­ä¹±çš„plugin,å°±è¿™ä¹ˆä¸€ä¸ªä¸ªçš„æŒ‚è½½åˆ°compileré‡Œé¢, å®Œå…¨çœ‹ä¸æ‡‚åˆ°åº•å¹²äº†ç‚¹å•¥å­, æ‰€ä»¥è®©æˆ‘ä»¬å…ˆçœ‹çœ‹pluginåˆ°åº•æ˜¯ä¸ªå•¥</p>
<h3 id="plugin"><a href="#plugin" class="headerlink" title="plugin"></a>plugin</h3><p>å…ˆè®©æˆ‘ä»¬çœ‹ä¸€ä¸ªwebpack plugin ç®€å•åˆ°ä¸èƒ½å†ç®€å•çš„ä¾‹å­<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pluginName = <span class="string">'ConsoleLogOnBuildWebpackPlugin'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConsoleLogOnBuildWebpackPlugin</span> </span>&#123;</span><br><span class="line">  apply(compiler) &#123;</span><br><span class="line">    compiler.hooks.run.tap(pluginName, compilation =&gt; &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'webpack æ„å»ºè¿‡ç¨‹å¼€å§‹ï¼'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è°ƒç”¨:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123; </span><br><span class="line">  ...</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> ConsoleLogOnBuildWebpackPlugin(),</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä»£ç å¾ˆç®€å•, æ‰€æœ‰æ’ä»¶éƒ½æ˜¯ä¸€ä¸ªclass, æ’ä»¶ä¼ å…¥é…ç½®çš„æ—¶å€™ä¼šè¢«å®ä¾‹åŒ–, è€Œwebpackåœ¨æ³¨å†Œpluginçš„æ—¶å€™ä¼šè°ƒç”¨è¿™ä¸ªå®ä¾‹çš„applyæ–¹æ³•, å¹¶æŠŠè¿™æ¬¡æ„å»ºçš„compilerä½œä¸ºå‚æ•°ä¼ å…¥,<br>è¿™ä¸ªcompilerä¼šåœ¨æ•´ä¸ªæ„å»ºå‘¨æœŸä¸­å­˜åœ¨, é‚£ä¹ˆè¿™å¥åˆ°åº•æ˜¯ä»€ä¹ˆå«ä¹‰?<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">compiler.hooks.run.tap(pluginName, compilation =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'webpack æ„å»ºè¿‡ç¨‹å¼€å§‹ï¼'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>å…¶å®ä»ä»£ç ä¸Šå¯ä»¥çœ‹åˆ°, è¿™æ®µä»£ç åœ¨compilerçš„é’©å­<code>run</code>ä¸ŠæŒ‚äº†ä¸€ä¸ªæ’ä»¶,å½“è¿™ä¸ªé’©å­è¢«è°ƒç”¨çš„æ—¶å€™, æˆ‘ä»¬ä¼ å…¥çš„å›è°ƒå‡½æ•°å°†ä¼šè¢«æ‰§è¡Œ<code>console.log(&#39;webpack æ„å»ºè¿‡ç¨‹å¼€å§‹ï¼&#39;)</code>;<br>é‚£ä¹ˆæˆ‘ä»¬çœ‹åˆ°çš„ä¸ª<code>hooks</code>åˆ°åº•æ˜¯ä»€ä¹ˆä¸œè¥¿? è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹compilerçš„æºç (æ³¨æ‰ä¸éœ€å…³æ³¨çš„ä»£ç ):</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">	SyncHook,</span><br><span class="line">	SyncBailHook,</span><br><span class="line">	AsyncParallelHook,</span><br><span class="line">	AsyncSeriesHook</span><br><span class="line">&#125; = <span class="built_in">require</span>(<span class="string">"tapable"</span>);</span><br><span class="line">...</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Compiler</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * @param &#123;string&#125; context the compilation path</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">constructor</span>(context) &#123;</span><br><span class="line">		<span class="keyword">this</span>.hooks = <span class="built_in">Object</span>.freeze(&#123;</span><br><span class="line">			shouldEmit: <span class="keyword">new</span> SyncBailHook([<span class="string">"compilation"</span>]),</span><br><span class="line">			done: <span class="keyword">new</span> AsyncSeriesHook([<span class="string">"stats"</span>]),</span><br><span class="line">			afterDone: <span class="keyword">new</span> SyncHook([<span class="string">"stats"</span>]),</span><br><span class="line">			additionalPass: <span class="keyword">new</span> AsyncSeriesHook([]),</span><br><span class="line">			beforeRun: <span class="keyword">new</span> AsyncSeriesHook([<span class="string">"compiler"</span>]),</span><br><span class="line">			run: <span class="keyword">new</span> AsyncSeriesHook([<span class="string">"compiler"</span>]), <span class="comment">// &lt;------------- ä¸Šé¢è°ƒç”¨çš„runåœ¨è¿™é‡Œ!!</span></span><br><span class="line">			emit: <span class="keyword">new</span> AsyncSeriesHook([<span class="string">"compilation"</span>]),</span><br><span class="line">			assetEmitted: <span class="keyword">new</span> AsyncSeriesHook([<span class="string">"file"</span>, <span class="string">"info"</span>]),</span><br><span class="line">			afterEmit: <span class="keyword">new</span> AsyncSeriesHook([<span class="string">"compilation"</span>]),</span><br><span class="line">			thisCompilation: <span class="keyword">new</span> SyncHook([<span class="string">"compilation"</span>, <span class="string">"params"</span>]),</span><br><span class="line">			compilation: <span class="keyword">new</span> SyncHook([<span class="string">"compilation"</span>, <span class="string">"params"</span>]),</span><br><span class="line">      normalModuleFactory: <span class="keyword">new</span> SyncHook([<span class="string">"normalModuleFactory"</span>]),</span><br><span class="line">      ...</span><br><span class="line">    &#125;);</span><br><span class="line">    ...</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥å‘ç°Compilerç±»çš„æ‰€æœ‰hookséƒ½æ˜¯ä¸€ä¸ªä¸ªä¸åŒç±»å‹çš„é’©å­çš„å®ä¾‹, è€Œè¿™äº›é’©å­éƒ½æ¥è‡ªäºåŒä¸€ä¸ªåº“<code>tapable</code>.</p>
<h3 id="tapableæ˜¯ä»€ä¹ˆ"><a href="#tapableæ˜¯ä»€ä¹ˆ" class="headerlink" title="tapableæ˜¯ä»€ä¹ˆ"></a>tapableæ˜¯ä»€ä¹ˆ</h3><p><code>tapable</code>æ˜¯ä»€ä¹ˆ?<br>æ—©å…ˆçš„webpack complier æ˜¯<code>tapable</code>çš„å®ä¾‹, ç°åœ¨ä»…ä»…æ˜¯<code>tapable</code>çš„è°ƒç”¨è€…, æˆ‘ä¹Ÿè§‰å¾—è¿™æ ·æ›´å¥½, æŠŠå¾ˆå¤šè°ƒç”¨æ”¾åˆ°å¤–éƒ¨, è¿œæ¯”ç»§æ‰¿ä¸€ä¸ªç¬¬ä¸‰æ–¹åº“è¦å¥½, ä»£ç çš„è°ƒç”¨æ›´æ˜æ˜¾,ä¸å†é‚£ä¹ˆéšæ™¦</p>
<p>å®é™…ä¸Šwebpackç¼–è¯‘æ‰“åŒ…ç±»ä¼¼äºä¸€ä¸ªæµæ°´çº¿, åœ¨æµæ°´çº¿ä¸Šæœ‰å¾ˆå¤šèŠ‚ç‚¹, ä¸åŒçš„èŠ‚ç‚¹æš´éœ²ä¸åŒçš„å±æ€§å’Œå€¼, ä½ å¯ä»¥å†ä¸åŒçš„èŠ‚ç‚¹å¯¹è¿™äº›å±æ€§å’Œå€¼å·¦è°ƒæ•´å¤„ç†, æœ€åç›´åˆ°æ‰“åŒ…å®Œæˆ. é‚£ä¹ˆwebpackæµæ°´çº¿ä¸­çš„ä¸åŒçš„èŠ‚ç‚¹æˆ‘ä»¬æˆä¸ºä¸åŒçš„é’©å­(hook), è€Œè¿™äº›é’©å­å°±æ˜¯ç”±<code>tapable</code>è´Ÿè´£ç”Ÿæˆçš„. </p>
<p>ä»Šå¤©å…ˆè¯´è¯´webpackçš„äº‹ä»¶æœºåˆ¶ <code>tapable</code></p>
<p>tapableå¾ˆåƒæˆ‘ä»¬äº†è§£çš„å‘å¸ƒè®¢é˜…æ¨¡å¼,æˆ‘ä»¬å…ˆçœ‹çœ‹<code>tapable</code>æ˜¯æ€ä¹ˆåšçš„</p>
<h3 id="tapable-æ€ä¹ˆç”¨"><a href="#tapable-æ€ä¹ˆç”¨" class="headerlink" title="tapable æ€ä¹ˆç”¨"></a>tapable æ€ä¹ˆç”¨</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> hook = <span class="keyword">new</span> SyncHook([<span class="string">"arg1"</span>, <span class="string">"arg2"</span>, <span class="string">"arg3"</span>]);</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæ˜¯æ–°å£°æ˜äº†ä¸€ä¸ªé’©å­, å¤§å®¶ç•™æ„, <code>SyncHook</code>çš„å®å‚ä¼ å…¥ä¸€ä¸ªæ•°ç»„ä¸ºå‚æ•°, æ¯ä¸€ä¸ªæ•°ç»„itemä»£è¡¨å°†æ¥æŒ‚è½½è¿™ä¸ªé’©å­ä¸Šçš„å›è°ƒå‡½æ•°æ—¶èƒ½å¤Ÿæ¥å—åˆ°çš„å‚æ•°æ•°é‡. å³æ—¶ä¹‹åæˆ‘ä»¬å†è§¦å‘é’©å­æ—¶ä¼ å…¥åœ¨å¤šçš„å®å‚, ä¹Ÿæ— æ³•è¶…è¿‡ä¸‰ä¸ª. ä½†æ˜¯è¿™é‡Œæœ‰ä¸€ä¸ªç–‘é—®, ä½†æ˜¯ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆå†™? ä¸ºä»€ä¹ˆä¸èƒ½å§è§¦å‘é’©å­ä¼ å…¥çš„æ‰€æœ‰å®å‚éƒ½åŒæ­¥ç»™é’©å­çš„å›è°ƒ? è¿™æ ·ä¸æ˜¯åº”è¯¥æ›´åŠ çµæ´»ä¹ˆ?è¿™ä»…ä»…æ˜¯ä¸€ç§ç±»ä¼¼æ³¨é‡Šçš„çº¦å®šä¹ˆ?æ–¹ä¾¿å¼€å‘æ›´å¿«çš„æ—¶å€™é’©å­å›è°ƒå†…çš„å‚æ•°æ˜¯ä»€ä¹ˆ? æˆ‘ä»¬è¿™é‡Œç•™ä¸€æ‰‹, æœ€åå†è®²</p>
<p>æˆ‘ä»¬è¿˜æ˜¯å…ˆæ¥çœ‹çœ‹<code>tapable</code>é‡Œé¢æœ‰ä»€ä¹ˆæŠŠ!å®ƒä¼šå¯¼å‡ºå¤šç§é’©å­ç±»å‹, ä»å¤§çš„ç±»å‹é‡Œèƒ½åˆ†ä¸º<code>SyncHook</code>, <code>AsyncSeriesHook</code>, <code>AsyncParalleHook</code>è¿™ä¸¤ç§, é¡¾åæ€ä¹‰, ä¸€ç§é’©å­çš„æ‰€æœ‰å›è°ƒéƒ½æ˜¯åŒæ­¥çš„, å¦ä¸¤ç§åˆ™æ˜¯å¼‚æ­¥çš„. ä¸¤ä¸ªå¼‚æ­¥é’©å­ä¸€ç§æ˜¯é¡ºåºæ‰§è¡Œ,ä¹Ÿå°±æ˜¯ä¸€ä¸ªæ¥ä¸€ä¸ª, å¦ä¸€ä¸ªåˆ™æ˜¯åŒæ­¥æ‰§è¡Œ, å°±æ˜¯ä¸€æ¬¡å§æ‰€æœ‰é’©å­å›è°ƒéƒ½æ‰§è¡Œ </p>
<p>å¤šä¸ªé’©å­åœ¨è°ƒç”¨ä¸Šä¹Ÿæœ‰ä¸åŒçš„è®²ç©¶, é€šå¸¸æ˜¯æ ¹æ®ä¸Šä¸€ä¸ªé’©å­å›è°ƒçš„è¿”å›å€¼æœ‰ä¸åŒçš„å¤„ç†, è§„åˆ™æœ‰å¦‚ä¸‹ä¸‰æ¬¾, è¿˜æœ‰ä¸€æ¬¾æ­£åœ¨è®¾è®¡å½“ä¸­</p>
<ul>
<li>basic (åŸºæœ¬æ¬¾)</li>
<li>waterfall (å¤§ç€‘å¸ƒæ¬¾)</li>
<li>bail (ä¿é™©æ¬¾)</li>
<li>loop (è‡ªç•™æ¬¾, todoâ€¦)</li>
</ul>
<p>åŸºæœ¬æ¬¾å°±ä¸å¤šè¯´äº†, æ‰€æœ‰çš„å›è°ƒä¾æ¬¡è°ƒç”¨, å¤§å®¶å¥½å¯¹ä¸€ä¸ªä¸ªæŠ¥æ•°å°±å¯ä»¥äº†<br>å¤§ç€‘å¸ƒæ¬¾, å…¶å®æ‰€æœ‰å›è°ƒä¾æ¬¡è°ƒç”¨, ä¸åŒçš„çš„æˆ¿æ˜¯, æ¯ä¸€ä¸ªå›è°ƒéƒ½èƒ½å¤Ÿæ¥å—åˆ°ä¸Šä¸€ä¸ªå›è°ƒçš„è¿”å›å€¼, å°±ç±»ä¼¼äºå’±ä»¬çš„å‡»é¼“ä¼ èŠ±å•¦<br>ä¿é™©æ¬¾, é¡¾åæ€ä¹‰, è·Ÿä¿é™©ä¸å·®ä¸å¤š, å†ä¾æ¬¡æ‰§è¡Œå›è°ƒçš„æ—¶å€™, å¦‚æœæœ‰ä»»ä½•ä¸€ä¸ªå›è°ƒæœ‰è¿”å›å€¼, åˆ™è¿™ä¸ªé’©å­çš„æ‰§è¡Œå°†æå‰ç»“æŸ</p>
<p>åŒæ­¥é’©å­å’Œå¼‚æ­¥é’©å­å†åŠ ä¸Šæˆ‘ä»¬åˆšæ‰è¯´çš„ä¸‰æ¬¾ä¸æ‡‚å¾—è°ƒç”¨å¤„ç†æ–¹å¼, å°±æŠŠæ•´ä¸ªé’©å­çš„ç±»å‹ç¿»äº†ä¸€å€, ä¸‹é¢è¿™äº›ä¹Ÿå°±æ˜¯<code>tapable</code>æä¾›çš„æ‰€æœ‰ç§ç±»é’©å­:</p>
<ul>
<li>SyncHook</li>
<li>SyncBailHook</li>
<li>SyncWaterfallHook</li>
<li>SyncLoopHook</li>
<li>AsyncParallelHook</li>
<li>AsyncParallelBailHook</li>
<li>AsyncSeriesHook</li>
<li>AsyncSeriesBailHook</li>
<li>AsyncSeriesWaterfallHook</li>
</ul>
<p>ä¸Šé¢çŸ¥é“äº†é’©å­éƒ½å«ä»€ä¹ˆ, ä¹ŸçŸ¥é“äº†ä¸ºå•¥å«è¿™ä¸ªåå­—, ä¸‹é¢æˆ‘ä»¬å°±æ¥çœ‹çœ‹é’©å­åº”è¯¥æ€ä¹ˆç”¨, è¯¥æ€ä¹ˆè§¦å‘<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰ä¸€ä¸ªé’©å­</span></span><br><span class="line"><span class="keyword">const</span> hook = <span class="keyword">new</span> SyncHook([<span class="string">"arg1"</span>, <span class="string">"arg2"</span>, <span class="string">"arg3"</span>]);</span><br><span class="line"></span><br><span class="line">hook.tap(<span class="string">'whatEver'</span>, (arg1, arg2, arg3) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(arg1, arg2, arg3) <span class="comment">// 1 2 3</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">hook.call(<span class="number">1</span>, <span class="number">2</span>,<span class="number">3</span>)</span><br></pre></td></tr></table></figure></p>
<p>å®é™…ä¸Šç¬¬ä¸€ä¸ªå‚æ•° å¯ä»¥æ˜¯ä¸€ä¸ªå¯¹è±¡, é‡Œé¢å¯ä»¥æœ‰ä¸ª<code>before</code>, <code>stage</code>, ç”¨æ¥è®¾ç½®è¿™ä¸ªpluginæ’å…¥çš„ä½ç½®<br>æ˜¯ä¸æ˜¯ç›¸ç»§äº†ä¸€èˆ¬çš„å‘å¸ƒè®¢é˜…æ¨¡å¼? <code>hook.tap</code>æ˜¯è®¢é˜…, <code>hook.call</code>æ˜¯å‘å¸ƒ</p>
<p>åˆšæˆ‘ä»¬çœ‹çš„æ˜¯æœ€æœ€æœ€ç®€å•çš„<code>SyncHook</code>, ä»–åªæœ‰ä¸€ç§æŒ‚åœ¨é’©å­å›è°ƒçš„æ–¹æ³•, å°±æ˜¯<code>tap</code>, å®é™…ä¸Šä¸åŒçš„é’©å­ç±»å‹, å®ƒæä¾›çš„æŒ‚è½½æ–¹å¼ä¹Ÿä¸åŒ, åˆ†æˆä¸‰ç§</p>
<ul>
<li>tap</li>
<li>tapPromise</li>
<li>tapAsync<br>åŒºåˆ«ä¹ŸæŒºç®€å•çš„, <code>tap</code>å°±æ˜¯åŒæ­¥æŒ‚è½½,æŒ‚è½½çš„å›è°ƒå‡½æ•°è‡ªç„¶æ˜¯ä¸€ä¸ªåŒæ­¥å‡½æ•°, <code>tapPromise</code>æŒ‚è½½çš„å¼‚æ­¥å‡½æ•°äº†, è¦æ±‚ä»–å¿…é¡»è¿”å›ä¸€ä¸ª<code>Promise</code>, <code>tabAsync</code>æŒ‚è½½çš„ä¹Ÿæ˜¯ä¸€ä¸ªå¼‚æ­¥å‡½æ•°, å‡½æ•°ä¸­çš„å½¢å‚<code>callback</code>ä»£è¡¨ç€å‡½æ•°çš„ç»“æŸ, ç±»ä¼¼<code>express</code>çš„<code>next</code>.</li>
</ul>
<p><code>tapable</code>ä¹Ÿæœ‰æ‹¦æˆªå™¨, å…¶å®å°±æ˜¯åœ¨æ¯ä¸ªé’©å­çš„ä¸åŒçŠ¶æ€è§¦å‘å‰çš„ä¸€ä¸ªæ§åˆ¶å‡½æ•°, è®©ä½ å¯¹æ•´ä¸ªé’©å­æœ‰æ›´å¤šçš„æ§åˆ¶èƒ½åŠ›<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">hook.intercept(&#123;</span><br><span class="line">  context: <span class="literal">true</span>, <span class="comment">// å¼€å¯æ—¶, å¯ä»¥å†æ‹¦æˆªå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ‹¿åˆ°contextå¯¹è±¡, contextå¯¹è±¡ä¹Ÿå¯ä»¥ä»æ‰€æœ‰çš„é’©å­å›è°ƒä¸­è·å¾—</span></span><br><span class="line">  <span class="comment">// hook è§¦å‘æ—¶</span></span><br><span class="line">	call: <span class="function">(<span class="params">arg1, arg2, arg2</span>) =&gt;</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// hook æ³¨å†Œæ—¶</span></span><br><span class="line">	register: <span class="function">(<span class="params">tapInfo</span>) =&gt;</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> tapInfo; </span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// æœ‰æ–°çš„é’©å­å›è°ƒæŒ‚è¿›æ¥æ—¶</span></span><br><span class="line">  tap: <span class="function">(<span class="params">tap</span>) =&gt;</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/12/20/æ·±å…¥webpack-tapableç¯‡/" data-id="ck9ik1ty3000cwhronp6qs6l2" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/webpack/">webpack</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-å‰ç«¯Né¢-elm-lang" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/11/22/å‰ç«¯Né¢-elm-lang/" class="article-date">
  <time datetime="2019-11-22T06:25:07.000Z" itemprop="datePublished">2019-11-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/11/22/å‰ç«¯Né¢-elm-lang/">å‰ç«¯Né¢-elm-lang</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="elmæ˜¯ä»€ä¹ˆ"><a href="#elmæ˜¯ä»€ä¹ˆ" class="headerlink" title="elmæ˜¯ä»€ä¹ˆ?"></a>elmæ˜¯ä»€ä¹ˆ?</h2><p><del>ä»–æ˜¯ä¸€ä¸ªè‘—åçš„å¤–å–å¹³å°</del></p>
<p>elmæ˜¯ä¸€é—¨å¼€å‘è¯­è¨€, æ˜¯ä¸€é—¨å‡½æ•°å¼è¯­è¨€, ä½†æ˜¯ä¸åŒäºå…¶ä»–å‡½æ•°å¼è¯­è¨€, å› ä¸ºè¿™é—¨è¯­è¨€åªèšç„¦åœ¨å‰ç«¯å¼€å‘æ–¹é¢, ä¹Ÿå°±æ˜¯è¯´,æœ€åå®ƒèƒ½å¤Ÿç¼–è¯‘æˆjavascript.<br>elmæ˜¯ä¸€é—¨å¾ˆå¹´è½»çš„è¯­è¨€, Evan Czaplicki å†2012å¹´æ‰æŠŠå®ƒè®¾è®¡å‡ºæ¥, è€Œä¸”æ˜¯åœ¨ä»–çš„æ¯•ä¸šè®¾è®¡ä¸Š(å¤§é›¾)â€¦<br>ä½†æ˜¯å°½ç®¡elméå¸¸å¹´è½», ä½†æ˜¾ç„¶å®ƒå†å‰ç«¯åœˆé‡Œä¹Ÿæ˜¯æœ‰è¿™ä¸¾è¶³è½»é‡çš„åœ°ä½çš„,è‡³äºä¸ºä»€ä¹ˆ, æˆ‘ä»¬ç¨åå†è¯´</p>
<h2 id="ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦äº†è§£elm"><a href="#ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦äº†è§£elm" class="headerlink" title="ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦äº†è§£elm"></a>ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦äº†è§£elm</h2><p>æœ€è¿‘ä¸¤å¹´, å› ä¸ºreact å’Œredux çš„å‡½æ•°å¼ç¼–ç¨‹æ€æƒ³, å¯¼è‡´å‰ç«¯çš„å‡½æ•°å¼ç¼–ç¨‹å¤§çƒ­. æˆ‘ä»¬ä¸è°ˆå‡½æ•°å¼ç¼–ç¨‹çœŸæ­£èƒ½ç»™å‰ç«¯å¸¦æ¥ä»€ä¹ˆ,ä»…ä»…è¯´å‡½æ•°å¼ç¼–ç¨‹ä½œä¸ºä¸€ç§å®Œå…¨ä¸åŒç¼–ç¨‹èŒƒå¼,<br>å†å­¦ä¹ è¿™ç§ç¼–ç¨‹æ€æƒ³çš„åŒæ—¶, ä¸€å®šèƒ½è¿‡æ‰©å®½æˆ‘ä»¬çš„ç¼–ç¨‹æ€è·¯, ä¸€äº›åå‡½æ•°å¼çš„åº“çš„å‡ºå‘ç‚¹å’ŒåŸºçŸ³, æ¯•ç«Ÿå†jsé‡Œå‡½æ•°ä¹Ÿæ˜¯ä¸€ç­‰å…¬æ°‘<br>å¦‚ä»Šå‰ç«¯æ¡†æ¶å¸æ”¶å‡½æ•°å¼ç¼–ç¨‹ä»¥åŠå¼ºç±»å‹è¯­è¨€ä¼˜ç‚¹çš„å½¢åŠ¿ä¸‹, ç”šè‡³å¯èƒ½ä¼šå¼€å¯æˆ‘ä»¬å¯¹å‰ç«¯çš„é‡æ–°è®¤è¯†</p>
<h2 id="elmæœ‰ä»€ä¹ˆç‰¹ç‚¹"><a href="#elmæœ‰ä»€ä¹ˆç‰¹ç‚¹" class="headerlink" title="elmæœ‰ä»€ä¹ˆç‰¹ç‚¹?"></a>elmæœ‰ä»€ä¹ˆç‰¹ç‚¹?</h2><ul>
<li>å¼ºç±»å‹ (static type)</li>
<li>å‡½æ•°å¼è¯­è¨€ (fpr)</li>
<li>ä¸€æ¬¡ç¼–è¯‘, (å¤„å¤„è¿è¡Œ?) No Runtime Exceptions</li>
<li>æ•°æ®ä¸å¯å˜ (immutable) </li>
<li>è™šæ‹Ÿdom (Great Performance)</li>
</ul>
<h2 id="è¯­æ³•ç‰¹ç‚¹"><a href="#è¯­æ³•ç‰¹ç‚¹" class="headerlink" title="è¯­æ³•ç‰¹ç‚¹"></a>è¯­æ³•ç‰¹ç‚¹</h2><p>elmçš„è¯­æ³•æ˜¯æ¥æºäºhaskellçš„,è™½ç„¶ä¸æ˜¯haskellçš„æ–¹è¨€, ä½†è¿˜æ˜¯å¸æ”¶äº†å¾ˆå¤šå½¢å¼,ä¸€ä¸‹ä¸ä¼šå®Œå…¨å±•å¼€,<br>ç›´æŒ‘ä¸€äº›åé¢å®ä¾‹ç”¨çš„åˆ°çš„ä¸€äº›è¯­æ³•åšä»‹ç»</p>
<h3 id="list"><a href="#list" class="headerlink" title="list"></a>list</h3><p><code>list</code>å’Œjsé‡Œçš„<code>array</code>ç±»ä¼¼, ä½†æ˜¯æ¯ä¸€ä¸ªå€¼éƒ½å¿…é¡»æ˜¯ç›¸åŒçš„ç±»å‹<br><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">a</span> = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>] <span class="comment">-- correct </span></span><br><span class="line"><span class="title">a</span> = [<span class="number">1</span>, <span class="string">"2"</span>, <span class="number">3</span>, <span class="number">4</span>] <span class="comment">-- wrong</span></span><br></pre></td></tr></table></figure></p>
<h3 id="Records"><a href="#Records" class="headerlink" title="Records"></a>Records</h3><p>Record å’Œjsé‡Œçš„<code>Object</code>å¾ˆåƒ, ä»–çš„å®šä¹‰æ–¹æ³•æ˜¯:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">john</span> = &#123; first = <span class="string">"John"</span>, last = <span class="string">"Hobson"</span>, age = <span class="number">25</span> &#125;</span><br><span class="line"></span><br><span class="line">.last john // <span class="string">"Hobson"</span>  .last æ˜¯ä¸€ä¸ªrecordsè®¿é—®å™¨</span><br><span class="line"></span><br><span class="line"><span class="title">john</span>.last // <span class="string">"Hobson"</span> ç›´æ¥è®¿é—®last</span><br><span class="line"></span><br><span class="line">&#123;john | last = 'blabla' &#125; // &#123; first = "John", last = "blabla", age = 25 &#125;</span><br></pre></td></tr></table></figure>
<h3 id="Function"><a href="#Function" class="headerlink" title="Function"></a>Function</h3><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">add</span> : <span class="type">Int</span> -&gt; <span class="type">Int</span> -&gt; <span class="type">Int</span> // ç±»å‹å®šä¹‰</span><br><span class="line"><span class="title">add</span> a b = a + b // function add (a,b) &#123;return a + b&#125;</span><br><span class="line"><span class="title">add</span> <span class="number">1</span> <span class="number">2</span>  // <span class="number">3</span></span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œå°±å¯ä»¥å‘ç°elmçš„å‡½æ•°å¼ç‰¹ç‚¹, å†æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå‡½æ•°çš„æ—¶å€™, å¦‚æœæœ‰å¤šä¸ªå‚æ•°, å‚æ•°å’Œå‚æ•°ä¹‹é—´çš„å®šä¹‰ä½¿ç”¨<code>-&gt;</code>æ¥åˆ†å‰²çš„,<br>å…¶å®è¿™ä¹Ÿè¡¨åäº†è¿™ä¸ªå‡½æ•°æ˜¯è¢«ç§‘é‡ŒåŒ–çš„,å‡½æ•°çš„æ‰§è¡Œå¯ä»¥è¢«åˆ†è§£æˆä»¥ä¸‹ä¸¤éƒ¨</p>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">temp</span> = add <span class="number">1</span> // init -&gt; init</span><br><span class="line"><span class="title">temp</span> <span class="number">2</span> // <span class="number">3</span></span><br></pre></td></tr></table></figure>
<p>å†elmé‡Œæ‰€æœ‰çš„å‡½æ•°éƒ½æ˜¯è¢«ç§‘é‡ŒåŒ–çš„, ç§‘é‡ŒåŒ–çš„å¥½å¤„? æ‰“ä¸ªæ¯”æ–¹<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">repeat(<span class="number">10</span>, <span class="string">'a'</span>) <span class="comment">// 'aaaaaaaaaa'</span></span><br><span class="line"><span class="comment">// ç§‘é‡ŒåŒ–å</span></span><br><span class="line">repeat(<span class="number">10</span>)(<span class="string">'a'</span>) <span class="comment">// 'aaaaaaaaaa'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ²¡æœ‰ç§‘é‡ŒåŒ–</span></span><br><span class="line">repeat10(str) &#123;</span><br><span class="line">  <span class="keyword">return</span> repeat(<span class="number">10</span>, str);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç§‘é‡ŒåŒ–çš„</span></span><br><span class="line">repeat10 = repeat(<span class="number">10</span>)</span><br></pre></td></tr></table></figure></p>
<h3 id="pipeline"><a href="#pipeline" class="headerlink" title="pipeline"></a>pipeline</h3><p>å› ä¸ºæ˜¯å‡½æ•°å¼è¯­è¨€, ä¼šå‡ºç°å¤šå±‚çš„å‡½æ•°åµŒå¥—,æ¯”å¦‚å†jsä¸­<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">param</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> a = fa(param);</span><br><span class="line">  <span class="keyword">let</span> b = fb(a);</span><br><span class="line">  <span class="keyword">let</span> c = fc(c);</span><br><span class="line">  <span class="keyword">return</span> c</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// or</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">param</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> fc(fb(fa(param)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä½ ä¹Ÿå¯ä»¥é€šè¿‡<code>lodash</code> æˆ–è€… <code>ramda</code> è¿™æ ·çš„fpå·¥å…·åº“æ¥åšé“¾å¼è°ƒç”¨, è¿™é‡Œå°±ä¸ä¸€ä¸€å±•å¼€, æ„Ÿå…´è¶£çš„å¯ä»¥çœ‹å¯¹åº”çš„æ–‡æ¡£</p>
<p>è€Œå†elmé‡Œ, å°±æœ‰ä¸“é—¨çš„è¯­æ³•æ¥å¤„ç†è¿™ç§æƒ…å†µ<br><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">param</span> = </span><br><span class="line">  param</span><br><span class="line">    |&gt;fa</span><br><span class="line">    |&gt;fb</span><br><span class="line">    |&gt;fc</span><br></pre></td></tr></table></figure></p>
<p>ä¸€ä¸ªå­—, ä¼˜é›…</p>
<h3 id="type"><a href="#type" class="headerlink" title="type"></a>type</h3><p>elmæ˜¯ä¸€ä¸ªå¼ºç±»å‹è¯­è¨€, æ‰€ä»¥æ˜¾ç„¶æˆ‘ä»¬éœ€è¦å¯¹ç±»å‹åšå®šä¹‰, è¿™é‡Œé‡ç‚¹è®²ä¸€ä¸‹elmé‡Œé¢çš„union type, å› ä¸ºè¿™æ˜¯elmçš„é‡è¦æ ¸å¿ƒ</p>
<p>####æ™®é€šç±»å‹<br><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">User</span> : <span class="type">String</span> </span><br><span class="line">User tom = 'tom'</span><br><span class="line"><span class="type">User</span> num = <span class="number">1</span> // error</span><br></pre></td></tr></table></figure></p>
<p>####Union Type<br>Union type ç”¨æ¥è¡¨ç¤ºä¸€ç»„å¯èƒ½tagé›†åˆ,æ¯”å¦‚Hr, Admin éƒ½æ˜¯Userçš„ä¸€ä¸ªvariants</p>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="type">User</span> = <span class="type">Hr</span> <span class="type">String</span> | <span class="type">Admin</span> <span class="type">String</span></span><br></pre></td></tr></table></figure>
<p>è€ŒUnion type ä¹Ÿå¯ä»¥è¢«è§£æ„<br><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">getUserLabel</span>: <span class="type">User</span> -&gt; <span class="type">String</span></span><br><span class="line"><span class="title">getUserLabel</span> user = </span><br><span class="line">  <span class="keyword">case</span> user <span class="keyword">of</span></span><br><span class="line">    <span class="type">Hr</span> name -&gt;</span><br><span class="line">      name</span><br><span class="line">    <span class="type">Admin</span> name -&gt;</span><br><span class="line">      role ++ name</span><br><span class="line"></span><br><span class="line">```elm</span><br><span class="line">æ³¨æ„`<span class="keyword">case</span> user <span class="keyword">of</span>`ä¸‹é¢çš„ä»£ç , æ˜¯ä¸æ˜¯å’Œjsé‡Œçš„`switch`å¾ˆåƒ? æ‰€ä»¥union <span class="keyword">type</span>å¾ˆå¤šæƒ…å†µéƒ½è¢«å½“åšæ˜¯ä¸€ç§æ¡ä»¶åˆ¤æ–­</span><br><span class="line"></span><br><span class="line">```elm</span><br><span class="line"><span class="keyword">type</span> <span class="type">User</span> = <span class="type">Guest</span> <span class="type">String</span> | <span class="type">Admin</span> <span class="type">String</span> <span class="type">Int</span> </span><br><span class="line"><span class="title">getWelcomeMessage</span>: <span class="type">User</span> -&gt; <span class="type">String</span></span><br><span class="line"><span class="title">getWelcomeMessage</span> user =</span><br><span class="line">  <span class="keyword">case</span> user <span class="keyword">of</span></span><br><span class="line">     <span class="type">Guest</span> _-&gt;</span><br><span class="line">      <span class="string">"guest login!"</span></span><br><span class="line">    <span class="type">Admin</span> _ _ -&gt;</span><br><span class="line">      <span class="string">"admin login! welcome back!"</span></span><br></pre></td></tr></table></figure></p>
<h2 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h2><p>ok, å­¦å®Œä¸Šé¢çš„å‡ ä¸ªçŸ¥è¯†ç‚¹, æˆ‘ä»¬å¼€å§‹çœ‹ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹,æ¥äº†è§£ä¸€ä¸ªelmç¨‹åºæ˜¯å¦‚ä½•æ„æˆçš„å§!</p>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> Main <span class="keyword">exposing</span> (..)</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Browser</span><br><span class="line"><span class="keyword">import</span> Html <span class="keyword">exposing</span> (<span class="type">Html</span>, button, div, text, span, input)</span><br><span class="line"><span class="keyword">import</span> Html.Events <span class="keyword">exposing</span> (onClick, onInput)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- MAIN</span></span><br><span class="line"><span class="title">main</span> =</span><br><span class="line">  <span class="type">Browser</span>.sandbox &#123; init = init, update = update, view = view &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- MODEL</span></span><br><span class="line"><span class="keyword">type</span> <span class="keyword">alias</span> <span class="type">Model</span> =  &#123; count: <span class="type">Int</span> &#125; </span><br><span class="line"></span><br><span class="line"><span class="title">init</span> : <span class="type">Model</span></span><br><span class="line"><span class="title">init</span> = &#123; count = <span class="number">1</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- UPDATE</span></span><br><span class="line"><span class="keyword">type</span> <span class="type">Msg</span> = <span class="type">Increment</span> | <span class="type">Decrement</span> </span><br><span class="line"></span><br><span class="line"><span class="title">update</span> : <span class="type">Msg</span> -&gt; <span class="type">Model</span> -&gt; <span class="type">Model</span></span><br><span class="line"><span class="title">update</span> msg model =</span><br><span class="line">  <span class="keyword">case</span> msg <span class="keyword">of</span></span><br><span class="line">    <span class="type">Increment</span> -&gt;</span><br><span class="line">      &#123; model | count = model.count + <span class="number">1</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">Decrement</span> -&gt;</span><br><span class="line">      &#123; model | count = model.count + <span class="number">1</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- VIEW</span></span><br><span class="line"><span class="title">view</span> : <span class="type">Model</span> -&gt; <span class="type">Html</span> <span class="type">Msg</span></span><br><span class="line"><span class="title">view</span> model =</span><br><span class="line">  div []</span><br><span class="line">    [ button [ onClick <span class="type">Decrement</span> ] [ text <span class="string">"-"</span> ]</span><br><span class="line">    , div [] [ text (<span class="type">String</span>.fromInt model.count) ]</span><br><span class="line">    , button [ onClick <span class="type">Increment</span> ] [ text <span class="string">"+"</span> ]</span><br><span class="line">    ]</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œ<code>view</code>æ˜¯ä¸€ä¸ªå‡½æ•°,å®ƒä½¿ç”¨å½“å‰çš„<code>model</code>læ¥æ¸²æŸ“dom, ä½¿ç”¨çš„æ˜¯ç±»ä¼¼<code>jsx</code>çš„å‡½æ•°è°ƒç”¨, è¿™æ˜¯ä¸€ä¸ªçº¯çš„æ ‡å‡†çš„å‡½æ•°å¼ç»„ä»¶</p>
<p><code>update</code>å‡½æ•°æ¥å— <code>Msg</code>, æ ¹æ®ä¸åŒvariantsæ¥å¯¹modelåšæ›´æ–°, è¿™å’Œreduxçš„reduceræ˜¯éå¸¸ç±»ä¼¼çš„, ä¸åŒçš„variantså°±ç±»ä¼¼äºä¸åŒçš„<code>actionType</code><br>çŠ¶æ€è¢«ä¸€ä¸ªçº¯å‡½æ•°æ¥æ›´æ–°,å¹¶è¿”å›ä¸€ä¸ªæ–°çš„çŠ¶æ€</p>
<p><code>init</code>å®šä¹‰äº†å½“å‰çš„åˆè¯†çŠ¶æ€</p>
<p>æœ€åå½¢æˆä¸€ä¸ªæ•°æ®æµ init -&gt; view -&gt; update -&gt; init è¿™æ ·çš„ä¸€ä¸ªå•å‘æ•°æ®æµ</p>
<p>ä¸Šé¢å°±æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­, èƒ½å¤Ÿå¾ˆå¥½çš„æç°elmå¼€å‘çš„ç†å¿µ, å’Œå®ƒçš„ä»£ç è§£æ„, å…ˆçœ‹ä¸€ä¸‹ä¸Šé¢çš„å‡ è¡Œæ³¨é‡Š,<br>èƒ½æ˜æ˜¾çœ‹å‡ºæ¥, ä»£ç æŠŠç¨‹åºåˆ†æˆå‡ ä¸ªéƒ¨åˆ†:</p>
<ul>
<li>æ•°æ® (model  the state of your application)</li>
<li>è§†å›¾ (view  a way to turn your state into HTML)</li>
<li>æ›´æ–° (update  a way to update your state based on messages)</li>
</ul>
<p>elmç®¡è¿™ç§ç»“æ„å«åš <code>elm architecture</code>,<br><img src="https://guide.elm-lang.org/architecture/buttons.svg" alt="elm architecture"></p>
<p>æ˜¯ä¸æ˜¯å¾ˆåƒreduxçš„é€»è¾‘?å®é™…ä¸Šå¹¶ä¸æ˜¯elmå€Ÿé‰´äº†redux, è€Œæ˜¯reduxå€Ÿé‰´äº†elm! åŒæ—¶ä¹Ÿé¡ºä¾¿æ¿€å‘äº†<code>dva</code></p>
<blockquote>
<p>I read about Elm before Redux but didnâ€™t get it fully, later realized it was important influence. â€“ Dan Abrawov</p>
</blockquote>
<blockquote>
<p>Lightweight front-end framework based on redux, redux-saga and react-router. (Inspired by elm and choo) â€“ Dva</p>
</blockquote>
<h3 id="Side-Effects"><a href="#Side-Effects" class="headerlink" title="Side Effects"></a>Side Effects</h3><p>åˆšæ‰ä¸€ç›´åœ¨è¯´<code>elm</code>éƒ½æ˜¯çº¯å‡½æ•°, ä½†æ˜¯åœ¨å®é™…å¼€å‘ä¸­, æ˜¯ä¸å¯èƒ½è¿™ä¹ˆå®Œç¾çš„, æˆ‘ä»¬æœ‰å¾ˆå¤šåœºæ™¯éƒ½æ˜¯ä¸çº¯ç²¹çš„, æ¯”å¦‚io, network, å’Œå…¶ä»–jsä»£ç äº¤äº’ ç­‰ç­‰, <code>elm</code>ä½¿ç”¨<code>port</code>, å’Œä»–æœ¬èº«çš„rentimeå°è£…äº†è¿™å±‚é€»è¾‘,<br>è¿™æ ·éš”ç¦»äº†è¿™äº›æœ‰å‰¯ä½œç”¨çš„é€»è¾‘<br><img src="https://elmprogramming.com/images/chapter-5/5.5-side-effects/elm-runtime.svg" alt="img"></p>
<h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>å®é™…ä¸Š, ç›®å‰å¾ˆå°‘æœ‰äººåœ¨å†ç”Ÿäº§ç¯å¢ƒä½¿ç”¨elm, ä¸€æ–¹é¢æ˜¯å› ä¸ºå®ƒçš„ç¤¾åŒºä¸å¤Ÿå¼ºå¤§, è¿˜æœ‰ä¸€æ–¹é¢æ˜¯æ–‡æ¡£ä¸å¤Ÿå®Œå–„, å†æœ‰å°±æ˜¯æ¯”è¾ƒé™¡å³­çš„å­¦ä¹ æˆæœ¬, å¾€å¾€è®©äººæœ›è€Œç”Ÿç•  </p>
<p>ä¸è¿‡å¦‚æœçœŸçš„è¦å…¥æ‰‹å­¦ä¹ çš„è¯, ä½œè€…å†™çš„<a href="https://github.com/evancz/elm-todomvc" target="_blank" rel="noopener">TODOMVC</a>,çœ‹æ˜ç™½å°±å¾ˆä¸é”™å•¦<br>å¦‚æœä½ æ•¢å†ç”Ÿäº§ç¯å¢ƒä½¿ç”¨, é‚£ä½ æ˜¯çœŸæ­£çš„å‹‡å£«(å…¶å®è¿˜çœŸæœ‰)</p>
<h2 id="æ¨èé˜…è¯»"><a href="#æ¨èé˜…è¯»" class="headerlink" title="æ¨èé˜…è¯»"></a>æ¨èé˜…è¯»</h2><p>  <a href="https://elm-lang.org/" target="_blank" rel="noopener">elmå®˜ç½‘</a>  </p>
<p>  <a href="https://github.com/paldepind/functional-frontend-architecture" target="_blank" rel="noopener">functional-frontend-architecture, å¦‚ä½•ç”¨çº¯jsæ’¸ä¸€ä¸ªelm architecture</a>  </p>
<p>  <a href="https://elmprogramming.com/" target="_blank" rel="noopener">æ›´è¯¦ç»†çš„æ•™ç¨‹</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/11/22/å‰ç«¯Né¢-elm-lang/" data-id="ck9ik1txz0009whrowexupbsu" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-åˆè¯†Svelte" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/10/25/åˆè¯†Svelte/" class="article-date">
  <time datetime="2019-10-25T06:32:25.000Z" itemprop="datePublished">2019-10-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/10/25/åˆè¯†Svelte/">åˆè¯†Svelte</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="ä»€ä¹ˆæ˜¯Svelte"><a href="#ä»€ä¹ˆæ˜¯Svelte" class="headerlink" title="ä»€ä¹ˆæ˜¯Svelte?"></a>ä»€ä¹ˆæ˜¯Svelte?</h2><p>é¦–å…ˆ, svelteæ˜¯ä¸€ä¸ªå‰ç«¯æ¡†æ¶, åœ¨å›½å†…ä½¿ç”¨äººæ•°éå¸¸å°‘, ä½†æ˜¯å¦‚æœä½ åˆ°githubä¸Šå»çœ‹å®ƒçš„repo,ä½ ä¼šå‘ç°å±…ç„¶æœ‰25.3kçš„star.<br>ä»€ä¹ˆ? å±…ç„¶è¿™ä¹ˆå¤š? ä¸ºå•¥æˆ‘æ²¡å¬è¿‡å‘¢? ä¸æ˜¯åªæœ‰ä¸‰å¤§æ¡†æ¶ä¹ˆ? (é—®å·è„¸?)<br>é‚£ä»Šå¤©å°±æ¥ç»™å¤§å®¶ä»‹ç»ä¸€ä¸‹å®ƒå’Œæˆ‘ä»¬ç†Ÿæ‚‰çš„å¦å¤–å‡ ä¸ªå¸¸è§æ¡†æ¶<code>react</code> <code>vue</code> æœ‰ä»€ä¹ˆåŒºåˆ«?</p>
<h2 id="Svelteæœ‰ä»€ä¹ˆç‰¹ç‚¹"><a href="#Svelteæœ‰ä»€ä¹ˆç‰¹ç‚¹" class="headerlink" title="Svelteæœ‰ä»€ä¹ˆç‰¹ç‚¹"></a>Svelteæœ‰ä»€ä¹ˆç‰¹ç‚¹</h2><p>è®©æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹ç”¨<code>svelte</code>æ¥ä¹¦å†™ç»„ä»¶æ˜¯ä»€ä¹ˆæ ·å­çš„:</p>
<p>try.svelte<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">	<span class="keyword">let</span> count = <span class="number">0</span>;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">	<span class="function"><span class="keyword">function</span> <span class="title">handleClick</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="undefined">		count += 1;</span></span><br><span class="line"><span class="undefined">	&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">on:click</span>=<span class="string">&#123;handleClick&#125;</span>&gt;</span></span><br><span class="line">	Clicked &#123;count&#125; &#123;count === 1 ? 'time' : 'times'&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>æˆ‘ä»¬æœ‰ä¸€è¯´ä¸€, æ˜¯ä¸æ˜¯æœ‰ç‚¹åƒ<code>vue</code>çš„å†™æ³•? çœ‹æƒ³å»å¾ˆåƒæ˜¯<code>.vue</code>çš„æ–‡ä»¶å˜›!? ä½†åˆå¥½å°‘ç‚¹ä»€ä¹ˆ?</p>
<p>æ²¡æœ‰é”™! å°±æ˜¯å°‘äº†å¾ˆå¤šä¸œè¥¿, é¦–å…ˆæ—§å°‘äº†æ¡†æ¶çš„å¼•å…¥, ä¹Ÿå°‘äº†å¾ˆå¤šå£°æ˜è¯•çš„ä»£ç ,å¦‚æœè®©ä½ ç”¨<code>vue</code> <code>react</code> æ¥å†™è¿™ä¸ªä»£ç é€»è¾‘çš„è¯,<br>ææ€•éƒ½æ²¡æ³•å†™çš„è¿™ä¹ˆç²¾ç®€æŠŠ? å…¶å®è¿™å°±æ˜¯<code>Svelte</code>æ¡†æ¶å¯¹å¤–å®£ç§°çš„ç¬¬ä¸€ä¸ªç‰¹ç‚¹: â€˜Write less codeâ€™, æ•´ä¸ªä»£ç å‡ ä¹æ²¡æœ‰ä»»ä½•æ ·æ¿ä»£ç ,<br>çœ‹ä¸Šå»ååˆ†æ¸…çˆ½, ä¹Ÿåˆšå®¹æ˜“ç†è§£</p>
<p>å®é™…ä¸Šé€šå¸¸ä¸€ä¸ªåŠŸèƒ½çš„ä»£ç é‡, <code>svelte</code>è¦æ¯” <code>react</code>å°‘ä¸å°‘:<br><img src="https://static001.infoq.cn/resource/image/e0/7f/e0bfee0f9437fc88a1a6928738af117f.jpg" alt="å¯¹æ¯”"></p>
<p>è®©æˆ‘ä»¬çœ‹çœ‹ä»£ç ä¸ºä»€ä¹ˆè¿™ä¹ˆå°‘?æˆ‘ä»¬å‘ç°ä»£ç åœ¨å¯¹å˜é‡æ›´æ–°çš„æ—¶å€™å¹¶æ²¡æœ‰ä½¿ç”¨ç±»ä¼¼<code>react</code>çš„<code>setState</code>æ–¹æ³•, è€Œæ˜¯ç›´æ¥å¯¹å˜é‡è¿›è¡Œäº†å†èµ‹å€¼.<br>ä»…ä»…æ˜¯å¯¹å˜é‡è¿›è¡Œäº†èµ‹å€¼å°±å¯ä»¥å¼•å‘è§†å›¾çš„å˜åŒ–, å¾ˆæ˜¾ç„¶æ˜¯æ•°æ®å“åº”çš„, è¿™å°±æ˜¯<code>svelte</code>çš„ç¬¬äºŒä¸ªç‰¹ç‚¹: â€˜truly reactiveâ€™</p>
<p>ä½†æ˜¯å®ƒåˆå¾ˆå¥‡æ€ª,å› ä¸ºå®ƒåƒvueä¸€æ ·å§å˜é‡å£°æ˜åˆ°ä¸€ä¸ªå¯¹è±¡ä¸­æ¥è¿›è¡Œæ•°æ®åŠ«æŒ, é‚£åˆ°åº•æ˜¯æ€ä¹ˆåšåˆ°çš„å‘¢?</p>
<p>è®©æˆ‘ä»¬çœ‹çœ‹ä»–ç¼–è¯‘ä»¥åçš„ä»£ç , ç¼–è¯‘ä»¥åå˜æˆäº†è¿™æ ·â€¦</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* App.svelte generated by Svelte v3.12.1 */</span></span><br><span class="line"><span class="keyword">import</span> &#123; SvelteComponent, append, detach, element, init,</span><br><span class="line">	insert, listen, noop, safe_not_equal, set_data, space, text</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">"svelte/internal"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">create_fragment</span>(<span class="params">ctx</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> button, t0, t1, t2, t3_value = ctx.count === <span class="number">1</span> ? <span class="string">'time'</span> : <span class="string">'times'</span> + <span class="string">""</span>, t3, dispose;</span><br><span class="line">	<span class="keyword">return</span> &#123;</span><br><span class="line">		c() &#123;</span><br><span class="line">			button = element(<span class="string">"button"</span>); <span class="comment">// åˆ›å»ºä¸€ä¸ªbutton</span></span><br><span class="line">			t0 = text(<span class="string">"Clicked "</span>);  </span><br><span class="line">			t1 = text(ctx.count); <span class="comment">// å˜é‡count çš„textnode</span></span><br><span class="line">			t2 = space(); <span class="comment">// ç©ºæ ¼?</span></span><br><span class="line">			t3 = text(t3_value); <span class="comment">// ä¹‹å‰çš„ä¸‰å…ƒè¡¨è¾¾å¼çš„ç»“æœ çš„ textnode</span></span><br><span class="line">			dispose = listen(button, <span class="string">"click"</span>, ctx.handleClick); <span class="comment">// ç»™buttonå…ƒç´ æ·»åŠ ç‚¹å‡»æ—¶é—´</span></span><br><span class="line">		&#125;,</span><br><span class="line">		m(target, anchor) &#123;</span><br><span class="line">			insert(target, button, anchor); <span class="comment">// æ’å…¥åˆ°ç›®æ ‡å…ƒç´ </span></span><br><span class="line">			append(button, t0); <span class="comment">//  æŠŠæ–‡æœ¬æ·»åŠ åˆ°buttonä¸Š</span></span><br><span class="line">			append(button, t1);</span><br><span class="line">			append(button, t2);</span><br><span class="line">			append(button, t3);</span><br><span class="line">		&#125;,</span><br><span class="line">		p(changed, ctx) &#123;  <span class="comment">// æ•°æ®åˆ°domçš„æ“ä½œå‡½æ•°, è¿™é‡Œç›´æ¥æ”¹documentä¸Šçš„å¯¹åº”å…ƒç´ äº†!</span></span><br><span class="line">			<span class="keyword">if</span> (changed.count) &#123; set_data(t1, ctx.count); &#125; <span class="comment">// æ›´æ–° count textnode</span></span><br><span class="line">			<span class="keyword">if</span> ((changed.count) &amp;&amp; t3_value !== (t3_value = ctx.count === <span class="number">1</span> ? <span class="string">'time'</span> : <span class="string">'times'</span> + <span class="string">""</span>)) &#123;</span><br><span class="line">				set_data(t3, t3_value); <span class="comment">// æ›´æ–°ä¸‰å…ƒè¡¨è¾¾å¼çš„ textnode</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		i: noop, <span class="attr">o</span>: noop,</span><br><span class="line">		d(detaching) &#123; <span class="comment">// é”€æ¯ç»„ä»¶</span></span><br><span class="line">			<span class="keyword">if</span> (detaching) &#123; detach(button); &#125;</span><br><span class="line">			dispose();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">instance</span>(<span class="params">$$self, $$props, $$invalidate</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">let</span> count = <span class="number">0</span>; <span class="comment">// çœŸæ­£çš„å˜é‡å£°æ˜åˆå§‹åŒ–</span></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">handleClick</span>(<span class="params"></span>) </span>&#123;  <span class="comment">// clickå›è°ƒ åˆå§‹åŒ–</span></span><br><span class="line">		$$invalidate(<span class="string">'count'</span>, count += <span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> &#123; count, handleClick &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ç»„ä»¶çš„æ„é€ å‡½æ•°</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">SvelteComponent</span> </span>&#123;</span><br><span class="line">	<span class="keyword">constructor</span>(options) &#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">		init(<span class="keyword">this</span>, options, instance, create_fragment, safe_not_equal, []);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure>
<p>what? æ²¡æ³•çœ‹äº†,å¯¹ä¸å¯¹? è®©æˆ‘ä»¬å›è¿‡å¤´ä»”ç»†çœ‹çœ‹ä»£ç â€¦</p>
<p>çœ‹å®Œæ³¨é‡Š, æ˜¯ä¸æ˜¯å¤§æ¦‚ææ˜ç™½äº†. è¿™ä¸å°±æ˜¯jQueryä¹ˆ!</p>
<p>æ²¡é”™, å¤§æ¦‚æ„æ€å·®ä¸å¤š, å…¶å®æŠŠ<code>svelte</code>ç§°ä½œä¸€ä¸ªå‰ç«¯æ¡†æ¶æ˜¯ä¸æ°å½“çš„, ä»–æ›´åº”è¯¥è¢«ç§°ä½œç¼–è¯‘å™¨, æŠŠå¼€å¤´çš„<code>.svelet</code>æ–‡ä»¶ç¼–è¯‘æˆä¸Šé¢çš„å¯æ‰§è¡Œä»£ç .<br>è€Œä¸”ç¼–è¯‘åçš„ä»£ç ä¸­è°ƒç”¨çš„å¤§å¤šæ•°æ–¹æ³•éƒ½æ˜¯ä¸€äº›helper function, æ‰€ä»¥<code>svelte</code>çš„runtimeä»£ç é‡æ˜¯éå¸¸å°‘çš„,å®ƒä¸»è¦çš„å·¥ä½œéƒ½æ˜¯åœ¨ç¼–è¯‘æœŸå®Œæˆçš„.</p>
<p>å¹¶ä¸”æˆ‘ä»¬å‘ç°,æ•°æ®å’Œè§†å›¾çš„ç»‘å®š,ä½¿ç”¨çš„æ˜¯vanillaJs, æ•°æ®çš„å˜åŠ¨,ç›´æ¥ä¿®æ”¹å¯¹åº”çš„domèŠ‚ç‚¹,ä¹Ÿå°±æ˜¯è¯´,ä»–å¹¶æ²¡æœ‰ç”¨<code>virtual dom</code>!<br>è¿™å°±æ˜¯<code>svelte</code>çš„ç¬¬ä¸‰ä¸ªå–ç‚¹: â€˜no virtual domâ€™. æ˜¾ç„¶æˆ‘ä»¬ä¸éœ€è¦çŒœæµ‹ä¹ŸçŸ¥é“, ä»–çš„æ€§èƒ½ä¼šå¾ˆå¥½.</p>
<p>ä½œè€…åœ¨å®˜ç½‘ä¸Šè¯´:</p>
<blockquote>
<p>è™šæ‹ŸDOMä¸æ˜¯ä¸€ç§åŠŸèƒ½ã€‚è€Œæ˜¯ä¸€ç§å£°æ˜æ€§çš„ï¼ŒçŠ¶æ€é©±åŠ¨çš„UIå¼€å‘,çš„æœ€ç»ˆæ‰‹æ®µ.å› ä¸ºå®ƒä½¿ä½ æ— éœ€è€ƒè™‘çŠ¶æ€è½¬æ¢å³å¯æ„å»ºåº”ç”¨ç¨‹åºï¼Œå¹¶ä¸”æ€§èƒ½é€šå¸¸è¶³å¤Ÿå¥½ã€‚è¿™æ„å‘³ç€æ›´å°‘çš„é”™è¯¯ä»£ç ï¼Œè€Œå°†æ›´å¤šçš„æ—¶é—´èŠ±è´¹æ„å»ºåŠŸèƒ½ä¸Šï¼Œè€Œä¸æ˜¯ä¹å‘³çš„å·¥ä½œä¸Š. ä½†æ˜¯äº‹å®è¯æ˜ï¼Œæˆ‘ä»¬æ— éœ€ä½¿ç”¨è™šæ‹ŸDOMå°±å¯ä»¥å®ç°ç±»ä¼¼çš„ç¼–ç¨‹æ¨¡å‹-è¿™å°±æ˜¯Svelteçš„ç”¨æ­¦ä¹‹åœ°ã€‚</p>
</blockquote>
<p>å®é™…ä¸Šæœ€å, <code>svelte</code>ç¼–è¯‘å¥½çš„ä»£ç æ˜¯ä¸å†éœ€è¦ä»»ä½•ä¾èµ–çš„,æ˜¯ä¸€ä¸ªå¤©ç„¶çš„ç»„ä»¶, åªè¦æŠŠå¯¼å‡ºçš„ç±»ç›´æ¥å®ä¾‹åŒ–, ç»„ä»¶å°±è¢«æ­£ç¡®çš„æ·»åŠ äº†<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> el = <span class="keyword">new</span> App(&#123;</span><br><span class="line">  target: <span class="built_in">document</span>.body,</span><br><span class="line">  props: &#123;&#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>æ‰€ä»¥<code>svelte</code>å¾ˆå®¹æ˜“è¢«åµŒå…¥åˆ°å…¶ä»–æ¡†æ¶ä¸­å»ä½¿ç”¨</p>
<h2 id="svelteæ½œåœ¨çš„é—®é¢˜"><a href="#svelteæ½œåœ¨çš„é—®é¢˜" class="headerlink" title="svelteæ½œåœ¨çš„é—®é¢˜"></a>svelteæ½œåœ¨çš„é—®é¢˜</h2><ul>
<li>è™½ç„¶å®ƒåªæœ‰å¾ˆå°‘çš„è¿è¡Œæ—¶ä»£ç ,ä½†ä»–æ„å»ºåçš„ä»£ç ,æœ‰å¯èƒ½æ¯”ç”¨<code>virtual dom</code>æ„å»ºçš„ä»£ç å¤š,å¹¶ä¸”æœ‰å¾ˆå¤šè¿è¡Œæ—¶ä»£ç çš„é‡å¤è°ƒç”¨. éšç€é¡¹ç›®çš„æ‰©å¤§,è¿è¡Œæ—¶ä»£ç çš„ä½“é‡ä¼˜åŠ¿ä¹Ÿä¼šè¶Šæ¥è¶Šå°, æœ€ç»ˆå®é™…ç”Ÿäº§é¡¹ç›®ä¸­èƒ½æœ‰å¤šå°‘å°ºå¯¸çš„ä¼˜åŠ¿å¾ˆéš¾è¯´</li>
<li>è™½ç„¶ç¼–è¯‘åçš„ä»£ç æ€§èƒ½å‡ ä¹å’Œ vanillaJsæŒå¹³, ç°åœ¨ä¸»æµæ¡†æ¶çš„virtual dom ä¹Ÿå¯ä»¥åšåˆ°åªæ¯”vanillaJsæ…¢1.5å€å·¦å³, è¿™ä¹Ÿè¯æ˜äº†ä¸ºäº†webé¡µé¢çš„æ€§èƒ½çš„ç“¶é¢ˆå¾ˆå¯èƒ½ä¸åœ¨domæœ¬èº«,è€Œåœ¨æ¡†æ¶</li>
<li>svelteçš„è¿™ç§å®ç°é€»è¾‘å¯¼è‡´å®ƒæ— æ³•è¢«åƒ<code>virtual dom</code>è¿™æ ·, å®¹æ˜“é™æ€åˆ†æ,ç»§è€Œç§»æ¤ä¸ºæœåŠ¡ç«¯æ¸²æŸ“, ä¹Ÿå¾ˆéš¾åŸºäºvNodeè¿›è¡Œæµ‹è¯•</li>
</ul>
<h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>ä¸è®ºå¦‚ä½•,ä¸å¾—ä¸è¯´, ä½œè€…åœ¨æ•´ä¸ªæ¡†æ¶æ€è·¯ä¸Š,éå¸¸çš„æ¸…å¥‡,ä¸ä¼—ä¸åŒ. çœ‹å®Œè®©æˆ‘çœ¼å‰ä¸€äº®. æœç„¶<code>virtual dom</code> å¹¶ä¸ä¸€å®šæ˜¯å‰ç«¯çš„çš„æœ€ä½³å®è·µ å‰ç«¯è¿˜ä¼šæœ‰å¾ˆå¤šè·¯è¦èµ°, æˆ‘ä»¬ä¹Ÿæœ‰å¾ˆå¤šä»£ç å€¼å¾—å»çœ‹.<br>æœ€åæä¸€å¥, ä½œè€…æ“ä½œè¿™ä¹ˆç§€, ä¸€å®šä¸æ˜¯æ™®é€šäºº,å¯¹å§? ä»–å°±æ˜¯å‰ç«¯è½®å­å“¥, ä¹Ÿæ˜¯<code>rollup</code>çš„ä½œè€… Rich-Harris. <a href="https://github.com/Rich-Harris" target="_blank" rel="noopener">è¿™æ˜¯ä»–çš„github</a></p>
<h2 id="æ¨èé˜…è¯»"><a href="#æ¨èé˜…è¯»" class="headerlink" title="æ¨èé˜…è¯»"></a>æ¨èé˜…è¯»</h2><p><a href="https://svelte.dev" target="_blank" rel="noopener">svelte å®˜ç½‘</a><br><a href="https://blog.logrocket.com/truly-reactive-programming-with-svelte-3-0-321b49b75969/" target="_blank" rel="noopener">Truly reactive programming with Svelte 3.0</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/10/25/åˆè¯†Svelte/" data-id="ck9ik1txx0007whros6r0h6xs" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-10åˆ†é’Ÿä¸Šæ‰‹ast" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/08/29/10åˆ†é’Ÿä¸Šæ‰‹ast/" class="article-date">
  <time datetime="2019-08-29T12:06:26.000Z" itemprop="datePublished">2019-08-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/08/29/10åˆ†é’Ÿä¸Šæ‰‹ast/">10åˆ†é’Ÿä¸Šæ‰‹ast</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="ä»€ä¹ˆæ˜¯AST"><a href="#ä»€ä¹ˆæ˜¯AST" class="headerlink" title="ä»€ä¹ˆæ˜¯AST"></a>ä»€ä¹ˆæ˜¯AST</h2><p> AST(Abstract Syntax Tree)ç®€ç§°æ˜¯æŠ½è±¡è¯­æ³•æ ‘,æ˜¯æºä»£ç è¯­æ³•ç»“æ„çš„ä¸€ç§æŠ½è±¡è¡¨ç¤º.å®ƒä»¥æ ‘çŠ¶çš„å½¢å¼è¡¨ç°ç¼–ç¨‹è¯­è¨€çš„è¯­æ³•ç»“æ„ï¼Œæ ‘ä¸Šçš„æ¯ä¸ªèŠ‚ç‚¹éƒ½è¡¨ç¤ºæºä»£ç ä¸­çš„ä¸€ç§ç»“æ„.<br> æ¯”å¦‚ä¸€ä¸‹ä»£ç :<br> <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="number">1</span> = <span class="number">5</span>;</span><br></pre></td></tr></table></figure></p>
<p> è¿™è¡Œä»£ç å¤§è‡´ä¼šè¢«è§£æä¸ºä»¥ä¸‹ast<br> <figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"type"</span>: <span class="string">"VariableDeclaration"</span>,</span><br><span class="line">  <span class="attr">"declarations"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"type"</span>: <span class="string">"VariableDeclarator"</span>,</span><br><span class="line">      <span class="attr">"id"</span>: &#123;</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"Identifier"</span>,</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"a"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">"init"</span>: &#123;</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"NumericLiteral"</span>,</span><br><span class="line">        <span class="attr">"value"</span>: <span class="number">5</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"kind"</span>: <span class="string">"const"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è¿™é‡Œæ¨èä¸€ä¸ªå·¥å…· <a href="https://astexplorer.net/" target="_blank" rel="noopener">ast explorer</a>, å®ƒå¯ä»¥å¸®ä½ å¿«é€ŸæŠŠä»£ç è½¬æ¢æˆast, æé«˜ä½ çš„å¼€å‘æ•ˆç‡</p>
<p> å¯ä»¥çœ‹å‡ºæ¥, ä»£ç å˜æˆäº†ä¸€ä¸ªæ ‘ç»“æ„çš„æ•°ç»„å¯¹è±¡, æè¿°äº†ä¸€ä¸ªå¯¹ä¸€ä¸ªå˜é‡çš„èµ‹å€¼. é‚£ä¹ˆæˆ‘ä»¬èƒ½ç”¨astæ¥åšç‚¹ä»€ä¹ˆå‘¢?</p>
<h2 id="é‡æ–°è®¤è¯†babel"><a href="#é‡æ–°è®¤è¯†babel" class="headerlink" title="é‡æ–°è®¤è¯†babel"></a>é‡æ–°è®¤è¯†babel</h2><p> ç¤¾åŒºé‡Œ, èƒ½å¤Ÿè§£æjsä»£ç åˆ°astçš„å·¥å…·æœ‰å¾ˆå¤š, è¿™é‡Œæˆ‘ä»¬å°±ä½¿ç”¨å¤§å®¶éƒ½æ¯”è¾ƒç†Ÿæ‚‰çš„babelæ¥ä¸¾ä¾‹</p>
<p> <code>babel</code>æ˜¯ä¸€ä¸ªjsç¼–è¯‘å™¨,èƒ½å¤ŸæŠŠes6ç­‰è¯­æ³•ç¼–è¯‘æˆes5, å¹¶ä¸”ä»–è¿˜æä¾›äº†ä¸°å¯Œçš„å·¥å…·,å¯ä»¥è®©æˆ‘ä»¬åšå¾ˆå¤šæˆ‘ä»¬æƒ³å¹²çš„äº‹æƒ….æ¯”å¦‚:<br> <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Button &#125; <span class="keyword">from</span> <span class="string">'element'</span></span><br></pre></td></tr></table></figure></p>
<p> è½¬åŒ–æˆ:<br> <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Button <span class="keyword">from</span> <span class="string">'element/lib/Button'</span></span><br></pre></td></tr></table></figure></p>
<p>å¦‚æœæƒ³å®Œæˆè¿™æ ·çš„äº‹æƒ…,æˆ‘ä»¬éœ€è¦å¤§æ¦‚äº†è§£ä¸€ä¸‹babelçš„å·¥å…·åŒ…  </p>
<ol>
<li><code>@babel/parser</code>ç”¨æ¥æŠŠjsä»£ç è½¬æ¢æˆast</li>
<li><code>@babel/traverse</code>ç”¨æ¥å¸®åŠ©ä½ éå†ast</li>
<li><code>@babel/types</code> ç”¨æ¥å¸®åŠ©ä½ åˆ¤æ–­astèŠ‚ç‚¹,æˆ–ç”Ÿæˆç›¸åº”çš„èŠ‚ç‚¹</li>
<li><code>@babel/generator</code> ç”¨æ¥æŠŠastä»æ–°è½¬æ¢æˆjsä»£ç </li>
</ol>
<h2 id="å¼€å§‹"><a href="#å¼€å§‹" class="headerlink" title="å¼€å§‹"></a>å¼€å§‹</h2><p>è®©æˆ‘ä»¬æƒ³ä¸€ä¸‹, å¦‚æœè¦æŠŠä»£ç aè½¬å˜æˆä»£ç b, åº”è¯¥æ˜¯ä¸€ä¸ªä»€ä¹ˆæ€è·¯?æˆ‘çš„æ€è·¯æ˜¯:</p>
<ol>
<li>å…ˆå§jsè½¬æ¢æˆast</li>
<li>éå†astæ”¶é›†ä¿¡æ¯</li>
<li>æ›´å…·æ”¶é›†çš„ä¿¡æ¯ç”Ÿæˆast</li>
<li>æŠŠæ–°ç”ŸåŸçš„astè½¬æ¢ä¸ºjsä»£ç å¹¶è¾“å‡º</li>
</ol>
<h3 id="ç¬¬ä¸€æ­¥-è½¬æ¢ast"><a href="#ç¬¬ä¸€æ­¥-è½¬æ¢ast" class="headerlink" title="ç¬¬ä¸€æ­¥,è½¬æ¢ast"></a>ç¬¬ä¸€æ­¥,è½¬æ¢ast</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; parse &#125; <span class="keyword">from</span> <span class="string">'@babel/parser'</span>;</span><br><span class="line"><span class="keyword">import</span> traverse <span class="keyword">from</span> <span class="string">"@babel/traverse"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> code = <span class="string">"import &#123; Button &#125; from 'element'"</span>;</span><br><span class="line"><span class="comment">// ç”Ÿæˆä¼ å…¥codeçš„ast</span></span><br><span class="line"><span class="keyword">const</span> ast = parse(code);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> names = [];</span><br><span class="line">traverse(ast, &#123;</span><br><span class="line">    ImportDeclaration: <span class="function"><span class="keyword">function</span>(<span class="params">path</span>) </span>&#123;  <span class="comment">// åªå¤„ç†importè¯­å¥</span></span><br><span class="line">      <span class="keyword">const</span> sourceValue = path.node.source.value;</span><br><span class="line">      <span class="keyword">if</span> (sourceValue === <span class="string">'element'</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (types.isImportSpecifier(specifier)) &#123;  <span class="comment">// åªå¤„ç†è§£æ„æ–¹å¼å£°æ˜çš„å˜é‡æ˜</span></span><br><span class="line">          <span class="comment">// æ‹¿åˆ°æ‰€æœ‰ç»“æ„çš„å˜é‡å</span></span><br><span class="line">          names.push(specifier.local.name);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ ¹æ®æ”¶é›†åˆ°çš„è§£æ„å˜é‡ålist,ç”Ÿæˆæ–°çš„ast</span></span><br><span class="line"><span class="keyword">const</span> body = names.map(<span class="function">(<span class="params">name</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> source = types.stringLiteral(<span class="string">`element/lib/<span class="subst">$&#123;name&#125;</span>`</span>); <span class="comment">// ç”ŸæˆsourceèŠ‚ç‚¹</span></span><br><span class="line">  <span class="keyword">const</span> specifier = types.importDefaultSpecifier(types.identifier(name)); <span class="comment">// ç”Ÿæˆ specifierèŠ‚ç‚¹</span></span><br><span class="line">  <span class="keyword">return</span> types.ImportDeclaration([specifier], source);  <span class="comment">// ç”ŸæˆImportå£°æ˜èŠ‚ç‚¹</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨å¤–é¢åŒ…äº†ä¸€å±‚programèŠ‚ç‚¹, ç”Ÿæˆå®Œæ•´çš„æ ‘</span></span><br><span class="line"><span class="keyword">const</span> convertedAst = types.program(body, [], <span class="string">'module'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŠŠastè½¬æ¢æˆjsä»£ç å¹¶è¾“å‡º</span></span><br><span class="line"><span class="keyword">const</span> convertCode = generator(convertedAst).code;</span><br><span class="line"><span class="keyword">return</span> convertCode; <span class="comment">// import Button from 'element/lib/Button'</span></span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸Šå°±æ˜¯è¿™ä¸ªç®€å•å°åŠŸèƒ½çš„ç”¨æ³•, å¯ä»¥å‘ç°å…¶å®å°±æ˜¯æŒ‰éƒ¨å°±ç­çš„æ¥,ç±»ä¼¼äºæŠŠå¤§è±¡æ”¾è¿›å†°ç®±çš„æ€è·¯</p>
<p>å…¶å®åœ¨ç”Ÿæˆjsä»£ç çš„æ—¶å€™ä¹Ÿå¯ä»¥ç”¨<code>@babel/template</code>æ¥åš, ä¹Ÿå¯èƒ½ä¼šæ›´æ–¹ä¾¿, ç›¸å…³çš„å·¥å…·apiå¯ä»¥å†babelçš„ä¸»é¡µä¸ŠæŸ¥æ‰¾</p>
<p>ä¹Ÿè®¸è¿™ä¸ªbabelçš„å°æ —å­å¯ä»¥ä¸ºä½ æ‰“å¼€ä¸€æ‰‡é—¨, è®©ä½ èƒ½å¤ŸçŸ¥é“, å…¶å®ä½ å¯ä»¥åšçš„æ›´å¤š</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/08/29/10åˆ†é’Ÿä¸Šæ‰‹ast/" data-id="ck9ik1txs0003whro2vqsw2st" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-react-router4å­¦ä¹ (1)" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/05/16/react-router4å­¦ä¹ (1)/" class="article-date">
  <time datetime="2019-05-16T15:16:58.000Z" itemprop="datePublished">2019-05-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/05/16/react-router4å­¦ä¹ (1)/">react-router4å­¦ä¹ </a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>#å‰è¨€ </p>
<p>react-router4å‡ºæ¥æœ‰å¾ˆä¹…äº†, ä¸€ç›´æ²¡æœ‰ä½¿ç”¨è¿‡, æœ€è¿‘è®¡åˆ’å­¦ä¹ ä¸€ä¸‹react16ä»¥åŠç›¸å…³çš„ç”Ÿæ€åº“, å°±æ‰“ç®—ä»react-router4å¼€å§‹äº†, æ¯•ç«Ÿç°åœ¨å·²ç»æ˜¯å¤§è¡Œå…¶é“äº†, æˆ‘ä¼šä»react-router3 å’Œroact-router4çš„å¼‚åŒæ¥æ…¢æ…¢è¯´æ˜ä¸¤è€…çš„åŒºåˆ«</p>
<p>#å£°æ˜æ–¹å¼</p>
<p>react-router3çš„è·¯ç”±å£°æ˜é€šå¸¸æ˜¯åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œå£°æ˜å®Œæ•´çš„è·¯ç”±å…³ç³»,æ¯”å¦‚:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;Router&gt;</span><br><span class="line">  &lt;Route path=<span class="string">"/"</span> component=&#123;App&#125;&gt;</span><br><span class="line">    &lt;Route path=<span class="string">"accounts"</span> component=&#123;Accounts&#125;/&gt;</span><br><span class="line">    &lt;Route path=<span class="string">"statements"</span> component=&#123;Statements&#125;&gt;</span><br><span class="line">      &lt;Route path=<span class="string">"info"</span> component=&#123;Info&#125;&gt;</span><br><span class="line">    &lt;<span class="regexp">/Router&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>Route&gt;</span><br><span class="line">&lt;<span class="regexp">/Router&gt;</span></span><br></pre></td></tr></table></figure>
<p>è·¯ç”±ç›¸å…³ç»„ä»¶ä¹‹é—´çš„è°ƒç”¨éå¸¸éšæ™¦, æ¯”å¦‚<code>App</code>ä¸ºä¸‹çº§è·¯ç”±ç»„ä»¶<code>Accounts</code>ä¼ é€’å€¼æ˜¯è¿™æ ·çš„:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="title">extend</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &#123;...props.children&#125; <span class="comment">// è¿™å¥å°±æ˜¯å¯¹Accountsçš„è°ƒç”¨</span></span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
<p>ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºæ¥, ä»ä»£ç é€»è¾‘ä¸Š,å®Œå…¨çœ‹ä¸å‡º<code>App</code>è°ƒç”¨äº†<code>Accounts</code>,è¿™å¯¼è‡´äº†ä»£ç çš„å¯è¯»æ€§éå¸¸çš„å·®.</p>
<p>é‚£ä¹ˆreact-router4çš„è·¯ç”±å£°æ˜å˜æˆäº†ä»€ä¹ˆæ ·å­å‘¢?<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="title">extend</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;Route path=<span class="string">"accounts"</span> component=&#123;Accounts&#125;/&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure></p>
<p>å˜æˆäº†è¿™æ ·!æ˜¯ä¸æ˜¯ä¸€ç›®äº†ç„¶?ç°åœ¨å˜æˆäº†é‚£é‡Œæœ‰è·¯ç”±éœ€æ±‚, é‚£é‡Œå£°æ˜è·¯ç”±çš„æ–¹å¼.ç†Ÿæ‚‰<code>vue</code>çš„åŒå­¦åº”è¯¥å·²ç»çœ‹å‡ºæ¥,è¿™ç§å†™æ³•å’Œ<code>vue-router</code>çš„è°ƒç”¨æ–¹å¼å¾ˆç›¸ä¼¼,æ¯”è¾ƒç®€å•æ˜äº†. å…¶å®æˆ‘ç¬¬ä¸€æ¬¡ç”¨<code>react-router4</code>çš„æ—¶å€™ç”±äºæ²¡çœ‹æ–‡æ¡£,è¿˜è¢«å‘äº†ä¸€æ¬¡. </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/05/16/react-router4å­¦ä¹ (1)/" data-id="ck9ik1txv0005whrokja223t8" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-2019å­¦ä¹ è®¡åˆ’" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/05/09/2019å­¦ä¹ è®¡åˆ’/" class="article-date">
  <time datetime="2019-05-09T10:43:06.000Z" itemprop="datePublished">2019-05-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/05/09/2019å­¦ä¹ è®¡åˆ’/">2019å­¦ä¹ è®¡åˆ’</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>#å­¦ä¹ è®¡åˆ’</p>
<ul>
<li>react16 å’Œç›¸å…³çš„ç”Ÿæ€èµ„æº, çœ‹éƒ¨åˆ†æºç </li>
<li>å­¦ä¹ webpackæ‰“åŒ…åŸç†, å·²ç»å†™ä¸€äº›loaderå’Œplugin</li>
<li>babel çš„æ·±åº¦ä½¿ç”¨å­¦ä¹  ast -&gt; è½¬æ¢ -&gt; å†ç¼–è¯‘</li>
<li>å‰ç«¯æ€§èƒ½çš„æ·±å…¥äº†è§£, åŒ…æ‹¬æµ‹è¯•, ç›‘æ§, è°ƒä¼˜</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/05/09/2019å­¦ä¹ è®¡åˆ’/" data-id="ck9ik1txo0001whronslfu5qr" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/webpack/">webpack</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/webpack/" style="font-size: 10px;">webpack</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/04/27/å¦‚ä½•è®¾è®¡ä¸€ä¸ªç®€å•çš„æ¨¡å—ç³»ç»Ÿ/">å¦‚ä½•è®¾è®¡ä¸€ä¸ªç®€å•çš„æ¨¡å—ç³»ç»Ÿ</a>
          </li>
        
          <li>
            <a href="/2020/03/29/å¦‚ä½•è®¾è®¡ä¸€ä¸ªæ’ä»¶ç³»ç»Ÿ/">å¦‚ä½•è®¾è®¡ä¸€ä¸ªæ’ä»¶ç³»ç»Ÿ</a>
          </li>
        
          <li>
            <a href="/2020/01/31/æ·±å…¥webpack-æ’ä»¶/">æ·±å…¥webpack-æ’ä»¶</a>
          </li>
        
          <li>
            <a href="/2019/12/20/æ·±å…¥webpack-tapableç¯‡/">æ·±å…¥webpack-tapableç¯‡</a>
          </li>
        
          <li>
            <a href="/2019/11/22/å‰ç«¯Né¢-elm-lang/">å‰ç«¯Né¢-elm-lang</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>